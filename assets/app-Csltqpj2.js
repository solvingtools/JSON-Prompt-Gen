import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css             */const Pt=()=>{console.log("Initializing History Sidebars...");const g=document.getElementById("history-sidebar"),e=document.getElementById("history-sidebar-overlay"),n=document.getElementById("history-hamburger-btn"),s=document.getElementById("history-sidebar-close"),r=document.getElementById("history-list");function m(){console.log("Opening History Modal Sidebar"),g&&g.classList.add("active"),e&&e.classList.add("active"),window.gaTracker&&window.gaTracker.trackEvent("history_sidebar_open",{type:"modal"})}function p(){console.log("Closing History Modal Sidebar"),g&&g.classList.remove("active"),e&&e.classList.remove("active")}n&&n.addEventListener("click",m),s&&s.addEventListener("click",p),e&&e.addEventListener("click",p),r&&r.addEventListener("click",function(G){G.target.closest(".history-item")&&!G.target.closest(".history-delete-btn")&&setTimeout(p,150)});const h=document.getElementById("history-section-sidebar"),y=document.getElementById("history-section-sidebar-overlay"),b=document.getElementById("history-section-hamburger-btn"),E=document.getElementById("history-section-sidebar-close"),C=document.getElementById("history-section-list");function _(){console.log("Opening History Section Sidebar"),h&&h.classList.add("active"),y&&y.classList.add("active"),window.gaTracker&&window.gaTracker.trackEvent("history_sidebar_open",{type:"section"})}function T(){console.log("Closing History Section Sidebar"),h&&h.classList.remove("active"),y&&y.classList.remove("active")}b&&b.addEventListener("click",_),E&&E.addEventListener("click",T),y&&y.addEventListener("click",T),C&&C.addEventListener("click",function(G){G.target.closest(".history-item")&&!G.target.closest(".history-delete-btn")&&setTimeout(T,150)}),window.historysSidebarController={open:m,close:p,openSection:_,closeSection:T},console.log("History sidebars initialized (modal + section)")};Pt();const qt={ALGORITHM:"AES-GCM",KEY_LENGTH:256,IV_LENGTH:12,SALT_LENGTH:16,ITERATIONS:1e5,async deriveKey(g,e){const n=new TextEncoder,s=await crypto.subtle.importKey("raw",n.encode(g),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:this.ITERATIONS,hash:"SHA-256"},s,{name:this.ALGORITHM,length:this.KEY_LENGTH},!1,["encrypt","decrypt"])},async encrypt(g,e){const n=new TextEncoder,s=crypto.getRandomValues(new Uint8Array(this.SALT_LENGTH)),r=crypto.getRandomValues(new Uint8Array(this.IV_LENGTH)),m=await this.deriveKey(e,s),p=await crypto.subtle.encrypt({name:this.ALGORITHM,iv:r},m,n.encode(g)),h=new Uint8Array(s.length+r.length+p.byteLength);return h.set(s,0),h.set(r,s.length),h.set(new Uint8Array(p),s.length+r.length),this.arrayBufferToBase64(h)},async decrypt(g,e){const n=new TextDecoder,s=this.base64ToArrayBuffer(g),r=s.slice(0,this.SALT_LENGTH),m=s.slice(this.SALT_LENGTH,this.SALT_LENGTH+this.IV_LENGTH),p=s.slice(this.SALT_LENGTH+this.IV_LENGTH),h=await this.deriveKey(e,r);try{const y=await crypto.subtle.decrypt({name:this.ALGORITHM,iv:m},h,p);return n.decode(y)}catch{throw new Error("Decryption failed. Invalid password or corrupted data.")}},async getDeviceFingerprint(){var g;try{const n=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset().toString(),((g=navigator.hardwareConcurrency)==null?void 0:g.toString())||"unknown"].join("|"),s=new TextEncoder,r=await crypto.subtle.digest("SHA-256",s.encode(n));return this.arrayBufferToBase64(new Uint8Array(r))}catch{return"default_device_salt_"+window.location.origin}},arrayBufferToBase64(g){let e="";const n=new Uint8Array(g);for(let s=0;s<n.byteLength;s++)e+=String.fromCharCode(n[s]);return btoa(e)},base64ToArrayBuffer(g){const e=atob(g),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}},Nt=[{id:"camera_techniques",name:"Camera Techniques",author:"System",terms:[{id:"close_up",name:"Close-up",definition:"A tight framing that focuses on a subject's face or a specific detail, emphasizing emotion or importance.",difficulty:"beginner",examples:["Emotional reactions","Detail emphasis","Intimate moments"],author:"System",likes:0},{id:"wide_shot",name:"Wide shot",definition:"Shows the entire subject and much of the surrounding environment, establishing context and scale.",difficulty:"beginner",examples:["Landscape reveals","Character in environment","Scene establishment"],author:"System",likes:0},{id:"medium_shot",name:"Medium shot",definition:"Frames a subject from the waist up, balancing body language with environmental context.",difficulty:"beginner",examples:["Dialogue scenes","Action sequences","Character introductions"],author:"System",likes:0},{id:"extreme_close_up",name:"Extreme close-up",definition:"Focuses on a tiny detail like an eye, hand, or object to create intense focus.",difficulty:"intermediate",examples:["Tension building","Object significance","Micro-expressions"],author:"System",likes:0},{id:"over_the_shoulder",name:"Over-the-shoulder shot",definition:"Camera placed behind one character to capture another, creating intimacy in conversations.",difficulty:"intermediate",examples:["Dialogue exchanges","Confrontations","Interview setups"],author:"System",likes:0},{id:"point_of_view",name:"Point-of-view shot",definition:"Shows exactly what a character is seeing, immersing the audience in their perspective.",difficulty:"intermediate",examples:["Subjective experience","Discovery moments","Horror reveals"],author:"System",likes:0},{id:"dutch_angle",name:"Dutch angle",definition:"Camera tilted to one side creating disorientation and unease.",difficulty:"advanced",examples:["Psychological tension","Villain introductions","Dream sequences"],author:"System",likes:0},{id:"high_angle",name:"High angle",definition:"Camera looks down on the subject, making them appear small or vulnerable.",difficulty:"beginner",examples:["Power dynamics","Helplessness","Overview shots"],author:"System",likes:0},{id:"low_angle",name:"Low angle",definition:"Camera looks up at the subject, making them appear powerful or imposing.",difficulty:"beginner",examples:["Hero moments","Authority figures","Intimidation"],author:"System",likes:0},{id:"establishing_shot",name:"Establishing shot",definition:"Sets up the context for a scene by showing the location or setting.",difficulty:"beginner",examples:["Location introductions","Time transitions","World-building"],author:"System",likes:0}]},{id:"lighting_setups",name:"Lighting Setups",author:"System",terms:[{id:"three_point",name:"Three-point lighting",definition:"Standard method using Key, Fill, and Back lights for balanced illumination.",difficulty:"beginner",examples:["Interview setups","Product photography","Portraits"],author:"System",likes:0},{id:"key_light",name:"Key light",definition:"The primary light source illuminating the subject.",difficulty:"beginner",examples:["Main subject focus","Directional shadows","Mood setting"],author:"System",likes:0},{id:"fill_light",name:"Fill light",definition:"Softens shadows created by the key light for balanced exposure.",difficulty:"beginner",examples:["Shadow reduction","Even lighting","Commercial look"],author:"System",likes:0},{id:"backlight",name:"Backlight",definition:"Light from behind separating subject from background.",difficulty:"intermediate",examples:["Silhouettes","Hair highlights","Depth creation"],author:"System",likes:0},{id:"practical",name:"Practical lighting",definition:"Real light sources within the scene like lamps and candles.",difficulty:"intermediate",examples:["Realistic ambiance","Period films","Natural motivation"],author:"System",likes:0},{id:"high_key",name:"High-key lighting",definition:"Bright, even illumination with few shadows for upbeat mood.",difficulty:"beginner",examples:["Comedies","Commercials","Music videos"],author:"System",likes:0},{id:"low_key",name:"Low-key lighting",definition:"Dark, moody lighting with high contrast for drama.",difficulty:"intermediate",examples:["Film noir","Thrillers","Horror"],author:"System",likes:0},{id:"natural",name:"Natural lighting",definition:"Using available light like sunlight or moonlight.",difficulty:"beginner",examples:["Documentary","Outdoor scenes","Golden hour"],author:"System",likes:0},{id:"rembrandt",name:"Rembrandt lighting",definition:"Triangle of light on the shadowed side of the face.",difficulty:"advanced",examples:["Portraits","Drama","Artistic shots"],author:"System",likes:0},{id:"butterfly",name:"Butterfly lighting",definition:"Light source placed above and directly centered on subject.",difficulty:"advanced",examples:["Glamour photography","Beauty shots","Fashion"],author:"System",likes:0}]},{id:"color_palettes",name:"Color Palettes",author:"System",terms:[{id:"monochromatic",name:"Monochromatic",definition:"Uses variations of a single color hue for unity.",difficulty:"beginner",examples:["Minimalist design","Mood consistency","Brand identity"],author:"System",likes:0},{id:"complementary",name:"Complementary colors",definition:"Colors opposite each other on the color wheel for contrast.",difficulty:"intermediate",examples:["Teal and orange","Visual pop","Action films"],author:"System",likes:0},{id:"analogous",name:"Analogous colors",definition:"Colors next to each other on the color wheel for harmony.",difficulty:"beginner",examples:["Nature scenes","Calm moods","Unified palettes"],author:"System",likes:0},{id:"triadic",name:"Triadic colors",definition:"Three colors evenly spaced on the color wheel.",difficulty:"advanced",examples:["Comic book aesthetics","Vibrant scenes","Playful tones"],author:"System",likes:0},{id:"warm_tones",name:"Warm tones",definition:"Reds, oranges, and yellows evoking heat or passion.",difficulty:"beginner",examples:["Romance","Action","Desert scenes"],author:"System",likes:0},{id:"cool_tones",name:"Cool tones",definition:"Blues, greens, and purples evoking cold or calm.",difficulty:"beginner",examples:["Sci-fi","Sadness","Night scenes"],author:"System",likes:0},{id:"desaturated",name:"Desaturated",definition:"Muted colors with low intensity for subdued mood.",difficulty:"intermediate",examples:["Post-apocalyptic","Drama","Historical"],author:"System",likes:0},{id:"high_contrast",name:"High contrast",definition:"Strong difference between light and dark areas.",difficulty:"intermediate",examples:["Noir style","Dramatic effect","Bold statements"],author:"System",likes:0},{id:"pastel",name:"Pastel palette",definition:"Soft, pale colors often for dreamlike vibes.",difficulty:"beginner",examples:["Fantasy","Romance","Childhood memories"],author:"System",likes:0},{id:"earth_tones",name:"Earth tones",definition:"Natural colors like browns, greens, and tans.",difficulty:"beginner",examples:["Westerns","Period pieces","Organic feel"],author:"System",likes:0}]},{id:"composition_principles",name:"Composition Principles",author:"System",terms:[{id:"rule_of_thirds",name:"Rule of thirds",definition:"Frame divided into nine equal segments for balanced placement.",difficulty:"beginner",examples:["Subject positioning","Horizon placement","Interview framing"],author:"System",likes:0},{id:"leading_lines",name:"Leading lines",definition:"Lines guiding the viewer's eye to the subject.",difficulty:"intermediate",examples:["Roads","Architecture","Natural paths"],author:"System",likes:0},{id:"framing",name:"Framing",definition:"Using objects to create a frame within the frame.",difficulty:"intermediate",examples:["Doorways","Windows","Natural arches"],author:"System",likes:0},{id:"symmetry",name:"Symmetry",definition:"Balanced arrangement of elements on screen.",difficulty:"intermediate",examples:["Wes Anderson style","Formality","Perfection"],author:"System",likes:0},{id:"negative_space",name:"Negative space",definition:"Empty space around the subject to create focus.",difficulty:"intermediate",examples:["Isolation","Minimalism","Emphasis"],author:"System",likes:0},{id:"golden_ratio",name:"Golden ratio",definition:"Mathematical ratio for aesthetically pleasing composition.",difficulty:"advanced",examples:["Classical art","Natural patterns","Premium look"],author:"System",likes:0},{id:"depth_layers",name:"Depth layers",definition:"Using foreground, midground, background for depth.",difficulty:"intermediate",examples:["3D effect","Immersion","Visual interest"],author:"System",likes:0},{id:"visual_weight",name:"Visual weight balance",definition:"Distributing visual elements to balance the shot.",difficulty:"advanced",examples:["Asymmetrical balance","Color weight","Size contrast"],author:"System",likes:0},{id:"diagonal",name:"Diagonal composition",definition:"Elements arranged diagonally for dynamic energy.",difficulty:"intermediate",examples:["Action scenes","Movement","Tension"],author:"System",likes:0},{id:"fg_mg_bg",name:"FG/MG/BG",definition:"Distinct foreground, middleground, and background layers.",difficulty:"beginner",examples:["Depth creation","Cinematic look","Scene complexity"],author:"System",likes:0}]},{id:"mood_descriptors",name:"Mood Descriptors",author:"System",terms:[{id:"suspenseful",name:"Suspenseful",definition:"Creating anticipation or anxiety in the viewer.",difficulty:"intermediate",examples:["Thriller scenes","Mystery reveals","Chase sequences"],author:"System",likes:0},{id:"romantic",name:"Romantic",definition:"Evoking intimacy, love, and softness.",difficulty:"beginner",examples:["Love scenes","First meetings","Soft lighting"],author:"System",likes:0},{id:"nostalgic",name:"Nostalgic",definition:"Evoking longing for the past.",difficulty:"intermediate",examples:["Flashbacks","Memory sequences","Vintage filters"],author:"System",likes:0},{id:"tense",name:"Tense",definition:"High stress or strain in the atmosphere.",difficulty:"intermediate",examples:["Confrontations","Time pressure","Danger"],author:"System",likes:0},{id:"serene",name:"Serene",definition:"Calm, peaceful, and untroubled atmosphere.",difficulty:"beginner",examples:["Nature scenes","Meditation","Resolution"],author:"System",likes:0},{id:"chaotic",name:"Chaotic",definition:"Disordered, confused, and active energy.",difficulty:"intermediate",examples:["Battle scenes","Crowds","Disasters"],author:"System",likes:0},{id:"melancholic",name:"Melancholic",definition:"Sad, pensive, and sorrowful tone.",difficulty:"intermediate",examples:["Loss scenes","Rainy days","Goodbyes"],author:"System",likes:0},{id:"hopeful",name:"Hopeful",definition:"Inspiring optimism and positive expectation.",difficulty:"beginner",examples:["Sunrise shots","Character growth","Resolutions"],author:"System",likes:0},{id:"foreboding",name:"Foreboding",definition:"Implying something bad will happen.",difficulty:"advanced",examples:["Horror setup","Dark clouds","Ominous music"],author:"System",likes:0},{id:"whimsical",name:"Whimsical",definition:"Playful, fanciful, and appealingly odd.",difficulty:"intermediate",examples:["Fantasy worlds","Children's films","Quirky characters"],author:"System",likes:0}]},{id:"camera_movement",name:"Camera Movement",author:"System",terms:[{id:"dolly",name:"Dolly shot",definition:"Camera moves physically toward or away from subject on tracks.",difficulty:"intermediate",examples:["Emotional reveals","Following action","Depth changes"],author:"System",likes:0},{id:"tracking",name:"Tracking shot",definition:"Camera moves alongside the subject.",difficulty:"intermediate",examples:["Long takes","Following shots","Graceful transitions"],author:"System",likes:0},{id:"pan",name:"Pan",definition:"Camera rotates horizontally on a fixed axis.",difficulty:"beginner",examples:["Landscape reveals","Character follow","Scene scanning"],author:"System",likes:0},{id:"tilt",name:"Tilt",definition:"Camera rotates vertically on a fixed axis.",difficulty:"beginner",examples:["Height reveals","Building shots","Power dynamics"],author:"System",likes:0},{id:"zoom",name:"Zoom",definition:"Changing focal length to appear closer or further.",difficulty:"beginner",examples:["Emphasis","Drama","Quick focus"],author:"System",likes:0},{id:"crane",name:"Crane shot",definition:"Camera moves high above via a mechanical arm.",difficulty:"advanced",examples:["Epic reveals","Overhead views","Production value"],author:"System",likes:0},{id:"handheld",name:"Handheld",definition:"Shaky, realistic movement held by operator.",difficulty:"beginner",examples:["Documentary feel","Action chaos","Immediacy"],author:"System",likes:0},{id:"steadicam",name:"Steadicam",definition:"Smooth movement using a stabilizing mount.",difficulty:"advanced",examples:["Long takes","Following shots","Controlled movement"],author:"System",likes:0},{id:"whip_pan",name:"Whip pan",definition:"Extremely rapid horizontal pan that creates motion blur streaks and disorienting effect.",difficulty:"advanced",examples:["Time transitions","Action emphasis","Psychological disorientation"],author:"System",likes:0},{id:"push_in",name:"Push-in",definition:"Camera physically moves closer to subject to increase intimacy or emphasize importance.",difficulty:"intermediate",examples:["Revelation moments","Emotional intensity","Focus concentration"],author:"System",likes:0}]},{id:"lens_techniques",name:"Lens Techniques",author:"System",terms:[{id:"shallow_dof",name:"Shallow depth of field",definition:"Subject sharp, background blurred for focus isolation.",difficulty:"intermediate",examples:["Portraits","Product focus","Romantic scenes"],author:"System",likes:0},{id:"deep_focus",name:"Deep focus",definition:"Everything from foreground to background is sharp.",difficulty:"advanced",examples:["Citizen Kane style","Complex blocking","Environmental detail"],author:"System",likes:0},{id:"rack_focus",name:"Rack focus",definition:"Shifting focus from one subject to another.",difficulty:"intermediate",examples:["Attention shift","Reveals","Connection between subjects"],author:"System",likes:0},{id:"wide_angle",name:"Wide-angle lens",definition:"Expands view, can distort edges for dramatic effect.",difficulty:"intermediate",examples:["Architecture","Cramped spaces","Exaggeration"],author:"System",likes:0},{id:"telephoto",name:"Telephoto lens",definition:"Compresses distance, brings background closer.",difficulty:"intermediate",examples:["Stalker POV","Compressed crowds","Isolation"],author:"System",likes:0},{id:"macro",name:"Macro shot",definition:"Extreme close-up of small objects.",difficulty:"intermediate",examples:["Insects","Textures","Product details"],author:"System",likes:0},{id:"anamorphic",name:"Anamorphic lens",definition:"Widescreen look with oval bokeh and signature flares.",difficulty:"advanced",examples:["Cinematic look","Sci-fi","High production"],author:"System",likes:0},{id:"bokeh",name:"Bokeh",definition:"Aesthetic quality of the blur in out-of-focus areas.",difficulty:"intermediate",examples:["Night lights","Romantic mood","Visual poetry"],author:"System",likes:0},{id:"lens_flare",name:"Lens flare",definition:"Light scattering in lens system creating visual artifacts.",difficulty:"intermediate",examples:["Sci-fi style","J.J. Abrams look","Sun shots"],author:"System",likes:0},{id:"tilt_shift",name:"Tilt-shift",definition:"Focus manipulation making scenes look miniature.",difficulty:"advanced",examples:["Toy effect","Time lapse","Unique perspective"],author:"System",likes:0}]},{id:"production_design",name:"Production Design",author:"System",terms:[{id:"set_dressing",name:"Set dressing",definition:"Decorating the set with furniture, props, and details.",difficulty:"beginner",examples:["Period accuracy","Character reflection","World building"],author:"System",likes:0},{id:"props",name:"Props",definition:"Items handled by actors that serve the story.",difficulty:"beginner",examples:["Weapons","Letters","Symbolic objects"],author:"System",likes:0},{id:"costume",name:"Costume design",definition:"Attire worn by characters to reflect personality and era.",difficulty:"intermediate",examples:["Character identity","Period films","Status indication"],author:"System",likes:0},{id:"location_scouting",name:"Location scouting",definition:"Finding real-world places to shoot.",difficulty:"intermediate",examples:["Authenticity","Unique backdrops","Practical considerations"],author:"System",likes:0},{id:"art_direction",name:"Art direction",definition:"Overall visual style and tone of production.",difficulty:"advanced",examples:["Unified vision","Genre style","Brand identity"],author:"System",likes:0},{id:"visual_motifs",name:"Visual motifs",definition:"Recurring visual elements with symbolic meaning.",difficulty:"advanced",examples:["Color symbolism","Repeated objects","Thematic imagery"],author:"System",likes:0},{id:"period_accuracy",name:"Period accuracy",definition:"Settings and costumes matching a specific era.",difficulty:"intermediate",examples:["Historical films","Retro aesthetics","Authenticity"],author:"System",likes:0},{id:"color_symbolism",name:"Color symbolism",definition:"Use of color to represent ideas and emotions.",difficulty:"advanced",examples:["Red for danger","Blue for sadness","Thematic consistency"],author:"System",likes:0},{id:"env_storytelling",name:"Environmental storytelling",definition:"Narrative communicated through set details.",difficulty:"advanced",examples:["Abandoned spaces","Character rooms","World history"],author:"System",likes:0},{id:"practical_effects",name:"Practical effects",definition:"Physical special effects done on set.",difficulty:"intermediate",examples:["Explosions","Animatronics","Weather effects"],author:"System",likes:0}]},{id:"sound_design",name:"Sound Design",author:"System",terms:[{id:"diegetic",name:"Diegetic sound",definition:"Sound emanating from the story world.",difficulty:"beginner",examples:["Dialogue","Radio music","Footsteps"],author:"System",likes:0},{id:"non_diegetic",name:"Non-diegetic sound",definition:"Sound outside story world like score and narration.",difficulty:"beginner",examples:["Soundtrack","Voice-over","Sound effects for mood"],author:"System",likes:0},{id:"sound_bridge",name:"Sound bridge",definition:"Sound carrying over from one scene to next.",difficulty:"intermediate",examples:["Seamless transitions","Audio continuity","Narrative connection"],author:"System",likes:0},{id:"foley",name:"Foley effects",definition:"Reproduction of everyday sound effects in post.",difficulty:"intermediate",examples:["Footsteps","Clothing rustle","Object handling"],author:"System",likes:0},{id:"ambient",name:"Ambient sound",definition:"Background noise establishing location.",difficulty:"beginner",examples:["City sounds","Nature","Room tone"],author:"System",likes:0},{id:"voice_over",name:"Voice-over narration",definition:"Off-screen voice narrating content.",difficulty:"beginner",examples:["Documentary","Inner thoughts","Story exposition"],author:"System",likes:0},{id:"sound_motif",name:"Sound motif",definition:"Recurring sound associated with character or idea.",difficulty:"advanced",examples:["Character themes","Leitmotifs","Symbolic sounds"],author:"System",likes:0},{id:"audio_perspective",name:"Audio perspective",definition:"Matching sound to distance of source.",difficulty:"intermediate",examples:["Close vs distant","POV audio","Immersive sound"],author:"System",likes:0},{id:"silence",name:"Silence as sound",definition:"Strategic use of silence for dramatic impact.",difficulty:"advanced",examples:["Tension","Shock","Contemplation"],author:"System",likes:0},{id:"layering",name:"Sound layering",definition:"Mixing multiple audio tracks for depth.",difficulty:"intermediate",examples:["Complex soundscapes","Immersive audio","Action sequences"],author:"System",likes:0}]},{id:"editing_techniques",name:"Editing Techniques",author:"System",terms:[{id:"cut",name:"Cut",definition:"Instant transition from one shot to another.",difficulty:"beginner",examples:["Basic transitions","Pace control","Scene changes"],author:"System",likes:0},{id:"fade",name:"Fade",definition:"Gradual transition to or from black.",difficulty:"beginner",examples:["Scene endings","Time passage","Dream sequences"],author:"System",likes:0},{id:"dissolve",name:"Dissolve",definition:"One shot gradually replaces another.",difficulty:"intermediate",examples:["Memory transitions","Time passage","Thoughtful pacing"],author:"System",likes:0},{id:"jump_cut",name:"Jump cut",definition:"Abrupt transition skipping time within same frame.",difficulty:"intermediate",examples:["Disorientation","Time compression","Energy"],author:"System",likes:0},{id:"match_cut",name:"Match cut",definition:"Cut matching visual or audio elements between scenes.",difficulty:"advanced",examples:["2001 bone to spacecraft","Thematic connections","Visual rhymes"],author:"System",likes:0},{id:"cross_cutting",name:"Cross-cutting",definition:"Alternating between two simultaneous scenes.",difficulty:"intermediate",examples:["Parallel action","Building tension","Comparisons"],author:"System",likes:0},{id:"montage",name:"Montage",definition:"Sequence compressing time or information.",difficulty:"intermediate",examples:["Training sequences","Passage of time","Emotional build"],author:"System",likes:0},{id:"continuity",name:"Continuity editing",definition:"Seamless flow between shots maintaining spatial coherence.",difficulty:"beginner",examples:["Invisible editing","180-degree rule","Match on action"],author:"System",likes:0},{id:"pacing",name:"Pacing rhythm",definition:"Tempo of cuts creating mood and energy.",difficulty:"intermediate",examples:["Fast cuts for action","Slow for drama","Rhythmic editing"],author:"System",likes:0},{id:"parallel",name:"Parallel editing",definition:"Showing two storylines simultaneously.",difficulty:"advanced",examples:["Converging narratives","Suspense building","Thematic juxtaposition"],author:"System",likes:0}]}],Mt={categories:Nt};class Ot{constructor(){this.data=null,this.categories=[],this.userCategories=[],this.isInitialized=!1,this.USER_DATA_KEY="user_cinematic_terms"}async init(){if(!this.isInitialized)try{this.data=Mt,this.categories=[...this.data.categories],this.loadUserData(),this.isInitialized=!0}catch(e){throw console.error("DictionaryService Error:",e),e}}loadUserData(){try{const e=localStorage.getItem(this.USER_DATA_KEY);if(e){const n=JSON.parse(e);this.userCategories=n.categories||[],this.userCategories.forEach(s=>{const r=this.categories.find(m=>m.id===s.id);r?s.terms.forEach(m=>{r.terms.find(p=>p.id===m.id)||r.terms.push(m)}):this.categories.push(s)})}}catch(e){console.error("Error loading user data:",e)}}saveUserData(){try{localStorage.setItem(this.USER_DATA_KEY,JSON.stringify({categories:this.userCategories}))}catch(e){console.error("Error saving user data:",e)}}getAllCategories(){return this.categories}getTermsByCategory(e){const n=this.categories.find(s=>s.id===e);return n?n.terms:[]}searchTerm(e){if(!e||!this.isInitialized)return[];const n=e.toLowerCase().trim(),s=[];return this.categories.forEach(r=>{const m=r.terms.filter(p=>p.name.toLowerCase().includes(n)||p.definition.toLowerCase().includes(n));m.length>0&&s.push({categoryName:r.name,categoryId:r.id,terms:m})}),s}addCategory(e){if(this.categories.find(r=>r.id===e.id))return console.warn("Category already exists:",e.id),!1;const s={id:e.id,name:e.name,author:e.author||"Anonymous",terms:e.terms||[]};return this.categories.push(s),this.userCategories.push(s),this.saveUserData(),!0}addTerm(e,n){const s=this.categories.find(p=>p.id===e);if(!s)return console.error("Category not found:",e),!1;const r={id:n.id||"user_"+Date.now(),name:n.name,definition:n.definition,difficulty:n.difficulty||"beginner",examples:n.examples||[],author:n.author||"Anonymous",likes:n.likes||0};s.terms.push(r);let m=this.userCategories.find(p=>p.id===e);return m||(m={id:e,name:s.name,terms:[]},this.userCategories.push(m)),m.terms!==s.terms&&m.terms.push(r),this.saveUserData(),!0}deleteTerm(e,n){const s=this.categories.find(m=>m.id===e);if(!s)return!1;const r=s.terms.findIndex(m=>m.id===n);if(r>-1){s.terms.splice(r,1);const m=this.userCategories.find(p=>p.id===e);if(m){const p=m.terms.findIndex(h=>h.id===n);p>-1&&m.terms.splice(p,1)}return this.saveUserData(),!0}return!1}editTerm(e,n,s){const r=this.categories.find(h=>h.id===e);if(!r)return!1;const m=r.terms.find(h=>h.id===n);if(!m)return!1;Object.assign(m,{name:s.name||m.name,definition:s.definition||m.definition,difficulty:s.difficulty||m.difficulty,examples:s.examples||m.examples,author:s.author||m.author});const p=this.userCategories.find(h=>h.id===e);if(p){const h=p.terms.find(y=>y.id===n);h&&Object.assign(h,{name:s.name||h.name,definition:s.definition||h.definition,difficulty:s.difficulty||h.difficulty,examples:s.examples||h.examples,author:s.author||h.author})}return this.saveUserData(),!0}deleteCategory(e){const n=this.userCategories.findIndex(r=>r.id===e&&e.startsWith("user_"));if(n===-1)return console.warn("Cannot delete system category:",e),!1;const s=this.categories.findIndex(r=>r.id===e);return s>-1&&this.categories.splice(s,1),this.userCategories.splice(n,1),this.saveUserData(),!0}getTermById(e){for(const n of this.categories){const s=n.terms.find(r=>r.id===e);if(s)return{term:s,categoryId:n.id}}return null}isUserCreated(e){return e&&e.startsWith("user_")}isCategoryUserCreated(e){return e&&e.startsWith("user_")}}class Rt{constructor(){this.STORAGE_KEY="llm_vault",this.providers={openai:{name:"OpenAI",models:[{id:"gpt-5.2-pro",name:"GPT-5.2 Pro (Recommended)",maxTokens:4096},{id:"o4-mini",name:"o4-mini",maxTokens:4096},{id:"gpt-4.1-mini",name:"GPT-4.1 mini",maxTokens:4096},{id:"gpt-4.5",name:"GPT-4.5",maxTokens:4096}],endpoint:"https://api.openai.com/v1/chat/completions",validateEndpoint:"https://api.openai.com/v1/models"},anthropic:{name:"Anthropic",models:[{id:"claude-opus-4.5",name:"Claude Opus 4.5 (Recommended)",maxTokens:4096},{id:"claude-sonnet-4.5",name:"Claude Sonnet 4.5",maxTokens:4096},{id:"claude-opus-4.1",name:"Claude Opus 4.1",maxTokens:4096},{id:"claude-haiku-4.5",name:"Claude Haiku 4.5",maxTokens:4096}],endpoint:"https://api.anthropic.com/v1/messages"},gemini:{name:"Gemini",models:[{id:"gemini-3-pro",name:"Gemini 3 Pro (Recommended)",maxTokens:8192},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro",maxTokens:8192},{id:"gemini-3-flash",name:"Gemini 3 Flash",maxTokens:8192},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash-Lite",maxTokens:8192}],endpoint:"https://generativelanguage.googleapis.com/v1beta/models"}},this.activeProvider=null,this.config={}}async init(){await this.loadConfig()}async loadConfig(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const n=await CryptoUtils.getDeviceFingerprint(),s=await CryptoUtils.decrypt(e,n);this.config=JSON.parse(s)}}catch(e){console.warn("LLMService: Could not load config, starting fresh.",e.message),this.config={}}}async saveConfig(){try{const e=await CryptoUtils.getDeviceFingerprint(),n=await CryptoUtils.encrypt(JSON.stringify(this.config),e);localStorage.setItem(this.STORAGE_KEY,n)}catch(e){console.error("LLMService: Failed to save config.",e)}}async setProviderKey(e,n,s){if(!this.providers[e])throw new Error(`Unknown provider: ${e}`);this.config[e]={key:n,model:s||this.providers[e].models[0].id,lastUsed:null,requestCount:0},await this.saveConfig()}getProviderKey(e){var n;return((n=this.config[e])==null?void 0:n.key)||null}async removeProvider(e){delete this.config[e],await this.saveConfig()}getConfiguredProviders(){return Object.keys(this.config).filter(e=>{var n;return(n=this.config[e])==null?void 0:n.key})}async validateKey(e,n){try{switch(e){case"openai":return await this._validateOpenAI(n);case"anthropic":return await this._validateAnthropic(n);case"gemini":return await this._validateGemini(n);default:return{valid:!1,message:"Unknown provider"}}}catch(s){return{valid:!1,message:s.message}}}async _validateOpenAI(e){var r;const n=await fetch(this.providers.openai.validateEndpoint,{method:"GET",headers:{Authorization:`Bearer ${e}`}});return n.ok?{valid:!0,message:"API key is valid!"}:{valid:!1,message:((r=(await n.json()).error)==null?void 0:r.message)||"Invalid API key"}}async _validateAnthropic(e){var r;const n=await fetch(this.providers.anthropic.endpoint,{method:"POST",headers:{"x-api-key":e,"anthropic-version":"2023-06-01","content-type":"application/json","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-3-5-haiku-20241022",max_tokens:10,messages:[{role:"user",content:"Hi"}]})});return n.ok?{valid:!0,message:"API key is valid!"}:{valid:!1,message:((r=(await n.json()).error)==null?void 0:r.message)||"Invalid API key"}}async _validateGemini(e){var m;const n=`${this.providers.gemini.endpoint}?key=${e}`,s=await fetch(n);return s.ok?{valid:!0,message:"API key is valid!"}:{valid:!1,message:((m=(await s.json()).error)==null?void 0:m.message)||"Invalid API key"}}async generatePrompt(e,n,s={}){const r=this.config[e];if(!(r!=null&&r.key))throw new Error(`No API key configured for ${e}`);const m=this._buildSystemPrompt(s.modelProfile||null),p=this._buildUserPrompt(n);let h;switch(e){case"openai":h=await this._callOpenAI(r.key,r.model,m,p,s);break;case"anthropic":h=await this._callAnthropic(r.key,r.model,m,p,s);break;case"gemini":h=await this._callGemini(r.key,r.model,m,p,s);break;default:throw new Error("Unknown provider")}return r.lastUsed=new Date().toISOString(),r.requestCount=(r.requestCount||0)+1,await this.saveConfig(),this._cleanResponse(h)}_cleanResponse(e){return e?e.replace(/^(Prompt|Enhanced Prompt|Result|Response|Scene \d+|Output|Description):?\s*/i,"").replace(/^["'](.*)["']$/s,"$1").trim():""}async generateFullJson(e,n,s={}){const r=this.config[e];if(!(r!=null&&r.key))throw new Error(`No API key configured for ${e}`);const m=`You are a specialized AI for generating professional VEO video prompts in strict JSON format.
        
Your task is to take the user's rough scene inputs and transform them into a polished, cinematic JSON output.
Follow these rules strictly:
1. Output MUST be a valid JSON array of objects.
2. Each object must follow this schema:
   {
     "description": "Enhanced, detailed cinematic description",
     "camera": "Camera angle/movement (keep original if good, or enhance)",
     "lighting": "Lighting style (keep original if good, or enhance)",
     "negative_prompt": "Negative constraints"
   }
3. Enhance the 'description' field to be vivid, detailed, and use professional filmmaking terminology.
4. Keep the 'negative_prompt' robust but concise.
5. Do NOT add any markdown formatting (like \`\`\`json). Output raw JSON string only.
6. Maintain the exact number of scenes as the input.
7. Output ONLY the raw JSON content without any conversational filler or "Prompt" labels.`,p=`Here is the raw scene data to enhance and format as JSON:
${JSON.stringify(n,null,2)}`;let h;switch(e){case"openai":h=await this._callOpenAI(r.key,r.model,m,p,s);break;case"anthropic":h=await this._callAnthropic(r.key,r.model,m,p,s);break;case"gemini":h=await this._callGemini(r.key,r.model,m,p,s);break;default:throw new Error("Unknown provider")}return r.lastUsed=new Date().toISOString(),r.requestCount=(r.requestCount||0)+1,await this.saveConfig(),h.replace(/^```json\s*/i,"").replace(/\s*```$/,"").trim()}_buildSystemPrompt(e=null){let n=`You are PromptForge AI, an expert cinematic video prompt engineer. Your role is to enhance user scene descriptions into highly detailed, professional video generation prompts.

Guidelines:
- Incorporate specific cinematic techniques (camera angles, movements, lighting styles)
- Use vivid, evocative language that AI video models understand
- Maintain the user's creative intent while adding professional depth
- Keep responses focused and concise (max 200 words per scene)
- Output ONLY the refined descriptive text.
- DO NOT include labels like "Prompt:", "Enhanced:", or "Scene:".
- DO NOT include any introductory or concluding remarks.`;return e&&(n+=`

**Target Model: ${e.name}**
`,n+=`- ${e.description}
`,e.supportsCameraControls||(n+=`- This model does NOT support advanced camera controls. Avoid describing specific camera movements like "tracking shot" or "crane shot".
`),e.supportsNegativePrompt||(n+=`- This model does NOT support negative prompts. If the user mentions things to avoid, try to express constraints positively or rephrase.
`),n+=`- Allowed Frame Rates: ${e.allowedFrameRates.join(", ")} fps.
`,n+=`- Max Resolution: ${e.maxResolution}.
`),n}_buildUserPrompt(e){let n=`Enhance this scene description for AI video generation:

`;return n+=`Description: ${e.description||"A cinematic scene"}
`,e.camera&&(n+=`Camera: ${e.camera}
`),e.lighting&&(n+=`Lighting: ${e.lighting}
`),e.negative_prompt&&(n+=`Avoid: ${e.negative_prompt}
`),n}async _callOpenAI(e,n,s,r,m){var y;const p=await fetch(this.providers.openai.endpoint,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:n,messages:[{role:"system",content:s},{role:"user",content:r}],temperature:m.temperature||.7,max_tokens:m.maxTokens||500})});if(!p.ok){const b=await p.json();throw new Error(((y=b.error)==null?void 0:y.message)||"OpenAI API error")}return(await p.json()).choices[0].message.content}async _callAnthropic(e,n,s,r,m){var y;const p=await fetch(this.providers.anthropic.endpoint,{method:"POST",headers:{"x-api-key":e,"anthropic-version":"2023-06-01","content-type":"application/json","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:n,max_tokens:m.maxTokens||500,system:s,messages:[{role:"user",content:r}]})});if(!p.ok){const b=await p.json();throw new Error(((y=b.error)==null?void 0:y.message)||"Anthropic API error")}return(await p.json()).content[0].text}async _callGemini(e,n,s,r,m){var E,C;const p=`${this.providers.gemini.endpoint}/${n}:generateContent?key=${e}`,h=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:`${s}

${r}`}]}],generationConfig:{temperature:m.temperature||.7,maxOutputTokens:m.maxTokens||500}})});if(!h.ok){const _=await h.json();throw new Error(((E=_.error)==null?void 0:E.message)||"Gemini API error")}const y=await h.json();if(!y.candidates||y.candidates.length===0){const _=((C=y.promptFeedback)==null?void 0:C.blockReason)||"UNKNOWN_REASON";throw new Error(`Gemini blocked the request: ${_}. Please try a slightly different prompt.`)}const b=y.candidates[0];if(!b.content||!b.content.parts||b.content.parts.length===0){const _=b.finishReason||"SAFETY/FILTERING";throw new Error(`Gemini response generation failed: ${_}. The content may have been flagged by safety filters.`)}return b.content.parts[0].text}getUsageStats(){const e={};for(const[n,s]of Object.entries(this.config))s!=null&&s.key&&(e[n]={lastUsed:s.lastUsed,requestCount:s.requestCount||0,model:s.model});return e}}class vt{constructor(){this.STORAGE_KEY="json_prompt_gen_history",this.MAX_ITEMS=50}save(e,n="json"){const s=this.getAll(),r={id:Date.now().toString(36)+Math.random().toString(36).substr(2,5),timestamp:Date.now(),mode:n,content:e,summary:this._generateSummary(e)};return s.unshift(r),s.length>this.MAX_ITEMS&&(s.length=this.MAX_ITEMS),this._persist(s),r}getAll(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load history:",e),[]}}getById(e){return this.getAll().find(n=>n.id===e)}clear(){localStorage.removeItem(this.STORAGE_KEY)}delete(e){let n=this.getAll();n=n.filter(s=>s.id!==e),this._persist(n)}getDiff(e,n){const s=JSON.stringify(e,null,2),r=JSON.stringify(n,null,2),m=s.split(`
`),p=r.split(`
`);let h="",y=0,b=0;for(;y<m.length||b<p.length;){const E=m[y],C=p[b];E===C?(h+=`<div class="diff-line">${this._escapeHtml(E||"")}</div>`,y++,b++):(E!==void 0&&(h+=`<div class="diff-line diff-remove">- ${this._escapeHtml(E)}</div>`,y++),C!==void 0&&(h+=`<div class="diff-line diff-add">+ ${this._escapeHtml(C)}</div>`,b++))}return h}_generateSummary(e){const n=e.scenes?e.scenes.length:0,s=e.platform||"Unknown";return`${n} Scene${n!==1?"s":""} â€¢ ${s}`}_persist(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(n){if(console.error("Failed to save history:",n),e.length>1){const s=e.slice(0,Math.floor(e.length/2));this._persist(s)}}}_escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}class ft{constructor(){this.events=[],this.sessionId=this.generateSessionId(),this.init()}init(){this.trackEvent("session_start")}generateSessionId(){return"sess_"+Math.random().toString(36).substr(2,9)}trackEvent(e,n={}){const s={id:this.generateEventId(),name:e,timestamp:new Date().toISOString(),data:n,sessionId:this.sessionId};this.events.push(s),typeof window.gtag=="function"&&window.gtag("event",e,n)}generateEventId(){return"evt_"+Math.random().toString(36).substr(2,9)}trackGeneration(e,n,s){this.trackEvent("generate_prompt",{scene_count:e,mode:n,platform:s})}trackEnhance(e,n){this.trackEvent("enhance_scene",{char_diff:n-e})}trackError(e,n){this.trackEvent("error",{type:e,message:n})}}class Dt{constructor(e){this.analytics=e}async submitFeedback(e,n,s=null){return await new Promise(r=>setTimeout(r,1e3)),this.analytics&&this.analytics.trackEvent("feedback_submitted",{type:e,length:n.length,has_screenshot:!!s}),{success:!0,id:"fb_"+Date.now()}}}class jt{constructor(){this.currentStep=1,this.totalSteps=4,this.modal=document.getElementById("getting-started-modal"),this.closeBtn=document.getElementById("getting-started-close-btn"),this.nextBtn=document.getElementById("getting-started-next"),this.prevBtn=document.getElementById("getting-started-prev"),this.checkbox=document.getElementById("dont-show-again"),this.modal&&this.init()}init(){localStorage.getItem("hasSeenGettingStarted")||setTimeout(()=>this.show(),1e3),this.bindEvents(),window.showGettingStarted=()=>this.show()}show(){this.modal.classList.remove("hidden"),this.currentStep=1,this.updateStep()}hide(){this.modal.classList.add("hidden"),this.checkbox.checked&&localStorage.setItem("hasSeenGettingStarted","true")}updateStep(){document.querySelectorAll(".getting-started-step").forEach(n=>{n.classList.add("hidden")});const e=document.querySelector(`.getting-started-step[data-step="${this.currentStep}"]`);e&&e.classList.remove("hidden"),document.querySelectorAll(".progress-dot").forEach(n=>{const s=parseInt(n.dataset.dot);n.classList.toggle("active",s===this.currentStep)}),this.prevBtn.style.display=this.currentStep===1?"none":"inline-flex",this.nextBtn.textContent=this.currentStep===this.totalSteps?"Get Started":"Next"}next(){this.currentStep<this.totalSteps?(this.currentStep++,this.updateStep()):this.hide()}prev(){this.currentStep>1&&(this.currentStep--,this.updateStep())}bindEvents(){this.closeBtn.addEventListener("click",()=>this.hide()),this.nextBtn.addEventListener("click",()=>this.next()),this.prevBtn.addEventListener("click",()=>this.prev()),document.querySelectorAll(".progress-dot").forEach(e=>{e.addEventListener("click",()=>{this.currentStep=parseInt(e.dataset.dot),this.updateStep()})}),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.hide()})}}class Ht{constructor(){this.profiles={veo:{id:"veo",name:"Google Veo",maxResolution:"1080p",allowedResolutions:["1080p"],allowedAspectRatios:["16:9","9:16","1:1","4:3","21:9"],allowedFrameRates:["24","30"],supportsNegativePrompt:!0,supportsCameraControls:!0,maxPromptLength:500,description:"Google's high-fidelity video generation model aimed at cinematic realism."},sora:{id:"sora",name:"OpenAI Sora",maxResolution:"1080p",allowedResolutions:["1080p"],allowedAspectRatios:["16:9","9:16","1:1","4:3","21:9"],allowedFrameRates:["24","30","60"],supportsNegativePrompt:!1,supportsCameraControls:!0,maxPromptLength:300,description:"OpenAI's physics-simulating video model known for complex motion."},runway:{id:"runway",name:"Runway Gen-3 Alpha",maxResolution:"4K",allowedResolutions:["720p","1080p","4K"],allowedAspectRatios:["16:9","9:16","21:9"],allowedFrameRates:["24","30","60"],supportsNegativePrompt:!1,supportsCameraControls:!0,maxPromptLength:500,description:"Runway's latest model with advanced temporal consistency and realistic motion."},luma:{id:"luma",name:"Luma Dream Machine",maxResolution:"1080p",allowedResolutions:["1080p"],allowedAspectRatios:["16:9","9:16","1:1","4:3"],allowedFrameRates:["24","30"],supportsNegativePrompt:!0,supportsCameraControls:!0,maxPromptLength:400,description:"Fast, high-quality video model optimized for creative workflows."},kling:{id:"kling",name:"Kling",maxResolution:"1080p",allowedResolutions:["1080p"],allowedAspectRatios:["16:9","9:16","1:1"],allowedFrameRates:["30"],supportsNegativePrompt:!0,supportsCameraControls:!0,maxPromptLength:600,description:"Emerging high-motion model with strong character consistency."}}}getProfile(e){return this.profiles[e]||null}getCapability(e,n){const s=this.profiles[e];return s?s[n]:null}validateParams(e,n){const s=this.profiles[e];if(!s)return{valid:!0,violations:[]};const r=[];return n.resolution&&!s.allowedResolutions.includes(n.resolution)&&r.push({param:"resolution",message:`Resolution '${n.resolution}' is not supported by ${s.name}. Supported: ${s.allowedResolutions.join(", ")}`,suggested:s.allowedResolutions[0]}),n.aspectRatio&&!s.allowedAspectRatios.includes(n.aspectRatio)&&r.push({param:"aspect_ratio",message:`Aspect Ratio '${n.aspectRatio}' is not supported by ${s.name}. Supported: ${s.allowedAspectRatios.join(", ")}`,suggested:s.allowedAspectRatios[0]}),n.frameRate&&!s.allowedFrameRates.includes(String(n.frameRate))&&r.push({param:"frame_rate",message:`Frame Rate '${n.frameRate}' is not supported by ${s.name}. Supported: ${s.allowedFrameRates.join(", ")}`,suggested:s.allowedFrameRates[0]}),{valid:r.length===0,violations:r}}supports(e,n){const s=this.profiles[e];return s?!!s[n]:!0}validateContent(e){if(!e)return{safe:!0,flagged:[]};const s=["nsfw","naked","graphic violence","blood","hate speech"].filter(r=>e.toLowerCase().includes(r));return{safe:s.length===0,flagged:s}}formatPayload(e,n){var r;const s={target_model:((r=this.profiles[e])==null?void 0:r.name)||e,generated_at:new Date().toISOString(),...n};return e==="sora"?{model:"sora-1.0",prompts:n.scenes.map(m=>m.description),advanced_params:{...n.global_parameters},metadata:s}:s}}class Gt{constructor(){this.STORAGE_KEY="json_prompt_gen_global_params",this.modelService=new Ht,this.defaults={platform_preset:"veo",aspect_ratio:"16:9",resolution:"1080p",frame_rate:"24"},this.params=this.loadState()}loadState(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e)return{...this.defaults,...JSON.parse(e)}}catch(e){console.warn("Failed to load global params:",e)}return{...this.defaults}}saveState(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.params))}catch(e){console.warn("Failed to save global params:",e)}}getParams(){return{...this.params}}updateParam(e,n){if(this.params.hasOwnProperty(e)){this.params[e]=n;const s=this.params.platform_preset,r=this.modelService.validateParams(s,this.params);return r.valid||(r.violations.forEach(m=>{this.params[m.param]=m.suggested}),window.dispatchEvent(new CustomEvent("global-params-corrected",{detail:{violations:r.violations}}))),this.saveState(),!0}return!1}resetDefaults(){return this.params={...this.defaults},this.saveState(),this.params}}class $t{constructor(){this.dbName="JsonPromptGenDB",this.storeName="templates",this.dbVersion=1,this.db=null,this.initPromise=this.initDB()}initDB(){return new Promise((e,n)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=r=>{console.error("TemplateService: Database error",r.target.error),n("Database error: "+r.target.error)},s.onsuccess=r=>{this.db=r.target.result,e(this.db)},s.onupgradeneeded=r=>{const m=r.target.result;if(!m.objectStoreNames.contains(this.storeName)){const p=m.createObjectStore(this.storeName,{keyPath:"id"});p.createIndex("name","name",{unique:!1}),p.createIndex("updatedAt","updatedAt",{unique:!1}),p.createIndex("tags","tags",{unique:!1,multiEntry:!0})}}})}async getDB(){return this.db||await this.initPromise,this.db}async saveTemplate(e){const n=await this.getDB();return new Promise((s,r)=>{const p=n.transaction([this.storeName],"readwrite").objectStore(this.storeName),h={id:e.id||crypto.randomUUID(),name:e.name||"Untitled Template",description:e.description||"",content:e.content||{},tags:e.tags||[],createdAt:e.createdAt||Date.now(),updatedAt:Date.now(),usageCount:e.usageCount||0},y=p.put(h);y.onsuccess=()=>{s(h)},y.onerror=b=>{r("Error saving template: "+b.target.error)}})}async getTemplate(e){const n=await this.getDB();return new Promise((s,r)=>{const h=n.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);h.onsuccess=()=>{s(h.result)},h.onerror=y=>{r("Error fetching template: "+y.target.error)}})}async getAllTemplates(){const e=await this.getDB();return new Promise((n,s)=>{const h=e.transaction([this.storeName],"readonly").objectStore(this.storeName).index("updatedAt").openCursor(null,"prev"),y=[];h.onsuccess=b=>{const E=b.target.result;E?(y.push(E.value),E.continue()):n(y)},h.onerror=b=>{s("Error fetching all templates: "+b.target.error)}})}async deleteTemplate(e){const n=await this.getDB();return new Promise((s,r)=>{const h=n.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);h.onsuccess=()=>{s(!0)},h.onerror=y=>{r("Error deleting template: "+y.target.error)}})}}class Ut{constructor(e){this.services=e,this.currentPromptData=null,this.saveModal=null,this.galleryModal=null,this.saveForm=null,this.galleryGrid=null,this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.injectModals(),this.saveModal=document.getElementById("template-save-modal"),this.galleryModal=document.getElementById("template-gallery-modal"),this.saveForm=document.getElementById("template-save-form"),this.galleryGrid=document.getElementById("template-gallery-grid"),this.bindEvents()}injectModals(){document.body.insertAdjacentHTML("beforeend",`
            <!-- Save Template Modal -->
            <div id="template-save-modal" class="template-modal-overlay">
                <div class="template-modal save-dialog">
                    <div class="template-modal-header">
                        <h3 class="gradient-text">Save Template</h3>
                        <button class="close-modal-btn" data-target="template-save-modal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                    </div>
                    <form id="template-save-form">
                        <div class="template-modal-body">
                            <div class="template-form-group">
                                <label for="template-name">Template Name</label>
                                <input type="text" id="template-name" class="template-form-input" placeholder="e.g., Cinematic Sci-Fi Setup" required>
                            </div>
                            <div class="template-form-group">
                                <label for="template-desc">Description (Optional)</label>
                                <textarea id="template-desc" class="template-form-textarea" placeholder="Briefly describe what this template does..."></textarea>
                            </div>
                            <div class="template-form-group">
                                <label for="template-tags">Tags (Comma separated)</label>
                                <input type="text" id="template-tags" class="template-form-input" placeholder="scifi, dark, 8k">
                            </div>
                        </div>
                        <div class="template-modal-footer">
                            <button type="button" class="btn-secondary close-modal-btn" data-target="template-save-modal">Cancel</button>
                            <button type="submit" class="btn-primary">Save Template</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Template Gallery Modal -->
            <div id="template-gallery-modal" class="template-modal-overlay">
                <div class="template-modal">
                    <div class="template-modal-header">
                        <h3 class="gradient-text">Template Gallery</h3>
                        <button class="close-modal-btn" data-target="template-gallery-modal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                    </div>
                    <div class="template-modal-body">
                        <div id="template-gallery-grid" class="template-grid">
                            <!-- Templates will be injected here -->
                        </div>
                    </div>
                </div>
            </div>
        `)}bindEvents(){document.addEventListener("click",e=>{if(e.target.closest(".close-modal-btn")){const n=e.target.closest(".close-modal-btn").dataset.target;this.closeModal(n)}e.target.classList.contains("template-modal-overlay")&&this.closeModal(e.target.id)}),this.saveForm.addEventListener("submit",async e=>{e.preventDefault(),await this.handleSaveSubmit()})}openSaveModal(e){this.currentPromptData=e,this.saveForm.reset(),this.saveModal.classList.add("active"),document.getElementById("template-name").focus()}async openGallery(){await this.renderGallery(),this.galleryModal.classList.add("active")}closeModal(e){document.getElementById(e).classList.remove("active")}async handleSaveSubmit(){const e=document.getElementById("template-name").value,n=document.getElementById("template-desc").value,r=document.getElementById("template-tags").value.split(",").map(p=>p.trim()).filter(p=>p),m={name:e,description:n,tags:r,content:this.currentPromptData};try{await this.services.saveTemplate(m),this.closeModal("template-save-modal"),window.showToast&&window.showToast("Template Saved",`"${e}" has been saved to your gallery.`,"success")}catch(p){console.error("Failed to save template:",p),window.showToast&&window.showToast("Error","Failed to save template.","error")}}async renderGallery(){this.galleryGrid.innerHTML='<div class="template-loading">Loading templates...</div>';try{const e=await this.services.getAllTemplates();if(this.galleryGrid.innerHTML="",e.length===0){this.galleryGrid.innerHTML=`
                    <div class="template-empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
                        <p>No templates found. Create your first template from the generator!</p>
                    </div>
                `;return}e.forEach(n=>{const s=this.createTemplateCard(n);this.galleryGrid.appendChild(s)})}catch(e){console.error("Error rendering gallery:",e),this.galleryGrid.innerHTML='<div class="template-error">Failed to load templates.</div>'}}createTemplateCard(e){const n=document.createElement("div");n.className="template-card",n.onclick=r=>{r.target.closest(".icon-btn")||this.applyTemplate(e)};const s=new Date(e.updatedAt).toLocaleDateString();return n.innerHTML=`
            <div class="template-card-header">
                <h4 class="template-name" title="${e.name}">${e.name}</h4>
                <div class="template-actions">
                    <button class="icon-btn delete" title="Delete" onclick="window.templateUI.deleteTemplate('${e.id}', event)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            </div>
            <p class="template-desc">${e.description||"No description"}</p>
            <div class="template-info">
                <span>${s}</span>
                <span class="template-tag">${e.tags[0]||"Template"}</span>
            </div>
        `,n}async deleteTemplate(e,n){if(n.stopPropagation(),confirm("Are you sure you want to delete this template?"))try{await this.services.deleteTemplate(e),this.renderGallery(),window.showToast&&window.showToast("Deleted","Template removed.","success")}catch(s){console.error("Delete failed:",s)}}applyTemplate(e){const n=new CustomEvent("apply-template",{detail:e.content});window.dispatchEvent(n),this.closeModal("template-gallery-modal"),window.showToast&&window.showToast("Template Applied",`"${e.name}" loaded successfully.`,"success")}}window.CryptoUtils=qt;window.AnalyticsService=ft;window.historyService=new vt;document.addEventListener("DOMContentLoaded",()=>{var at,rt,dt,lt,ct,mt;try{new jt}catch(t){console.error("GettingStarted Init Error:",t)}try{const t=new $t,i=new Ut(t);window.templateUI=i}catch(t){console.error("Template System Init Error:",t)}const g=new ft;window.gaTracker=g;const e=document.getElementById("scenes-container"),n=document.getElementById("add-scene-btn"),s=document.getElementById("generate-btn"),r=document.getElementById("output-json"),m=document.getElementById("sidebar"),p=document.getElementById("sidebar-overlay"),h=document.getElementById("hamburger-btn"),y=document.getElementById("sidebar-close"),b=document.querySelectorAll(".sidebar-link"),E=document.getElementById("sidebar-reset-btn"),C=document.getElementById("sidebar-export-btn");function _(){m.classList.add("active"),p.classList.add("active"),document.body.style.overflow="hidden",g.trackEvent("sidebar_open")}function T(){m.classList.remove("active"),p.classList.remove("active"),document.body.style.overflow=""}h.addEventListener("click",_),y.addEventListener("click",T),p.addEventListener("click",T),b.forEach(t=>{t.addEventListener("click",i=>{const o=t.dataset.section;o&&(i.preventDefault(),Ce(o),T())})}),E&&E.addEventListener("click",t=>{var i;t.preventDefault(),g.trackEvent("sidebar_action",{action:"reset"}),T(),(i=document.getElementById("reset-btn"))==null||i.click()}),C&&C.addEventListener("click",t=>{var i;t.preventDefault(),g.trackEvent("sidebar_action",{action:"export"}),T(),(i=document.getElementById("download-btn"))==null||i.click()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&g.trackEvent("tab_wake_up")});const G=new Dt(g),A=new vt,me=document.getElementById("feedback-modal"),Pe=document.getElementById("sidebar-feedback-btn"),qe=document.getElementById("feedback-close-btn"),Ne=document.getElementById("feedback-cancel-btn"),ue=document.getElementById("feedback-submit-btn"),Me=document.querySelectorAll("#feedback-type-chips .chip");let ke="bug";function Oe(){me&&(me.classList.remove("hidden"),g.trackEvent("feedback_open"),T())}function Ee(){me&&me.classList.add("hidden")}const Re=document.getElementById("footer-feedback-btn");Pe&&Pe.addEventListener("click",Oe),Re&&Re.addEventListener("click",Oe),qe&&qe.addEventListener("click",Ee),Ne&&Ne.addEventListener("click",Ee),Me.forEach(t=>{t.addEventListener("click",()=>{Me.forEach(i=>i.classList.remove("active")),t.classList.add("active"),ke=t.dataset.value})}),ue&&ue.addEventListener("click",async()=>{const t=document.getElementById("feedback-message").value;if(!t.trim()){showToast("Error","Please enter a message.","error");return}ue.classList.add("loading");try{await G.submitFeedback(ke,t),showToast("Feedback Sent","Thank you for your feedback!","success"),g.trackEvent("submit_feedback",{type:ke}),document.getElementById("feedback-message").value="",Ee()}catch{showToast("Error","Failed to send feedback.","error")}finally{ue.classList.remove("loading")}});let L;try{L=new Gt}catch(t){console.error("GlobalParamsService Init Error:",t),L={getParams:()=>({platform_preset:"veo",aspect_ratio:"16:9",resolution:"1080p",frame_rate:"24"}),updateParam:()=>!1,resetDefaults:()=>({}),modelService:{validateContent:()=>({safe:!0}),validateParams:()=>({valid:!0})}}}const $=[{key:"aspect_ratio",wrapperId:"global-aspect-ratio-dropdown",inputId:"global-aspect-ratio",displayId:"global-aspect-ratio-display"},{key:"resolution",wrapperId:"global-resolution-dropdown",inputId:"global-resolution",displayId:"global-resolution-display"},{key:"frame_rate",wrapperId:"global-frame-rate-dropdown",inputId:"global-frame-rate",displayId:"global-frame-rate-display"},{key:"platform_preset",wrapperId:"global-platform-dropdown",inputId:"global-platform",displayId:"global-platform-display"}];$.forEach(t=>{const i=document.getElementById(t.wrapperId);if(!i)return;const o=i.querySelector(".dropdown-trigger"),a=i.querySelector(".dropdown-menu"),d=document.getElementById(t.inputId),l=document.getElementById(t.displayId);o.addEventListener("click",c=>{c.stopPropagation(),$.forEach(u=>{var f;u.wrapperId!==t.wrapperId&&((f=document.getElementById(u.wrapperId))==null||f.classList.remove("open"))}),i.classList.toggle("open")}),a.addEventListener("click",c=>{c.stopPropagation();const u=c.target.closest(".dropdown-item");if(u){const f=u.dataset.value,v=u.textContent;l.textContent=v,a.querySelectorAll(".dropdown-item").forEach(w=>w.classList.remove("selected")),u.classList.add("selected"),d.value=f,L.updateParam(t.key,f),g.trackEvent("parameter_change",{param:t.key,value:f}),he(),i.classList.remove("open")}})}),document.addEventListener("click",()=>{$.forEach(t=>{var i;(i=document.getElementById(t.wrapperId))==null||i.classList.remove("open")})});function pe(){const t=L.getParams(),i=(o,a)=>{const d=document.getElementById(o.wrapperId),l=document.getElementById(o.inputId),c=document.getElementById(o.displayId);if(d&&l&&c){l.value=a;const u=d.querySelector(`.dropdown-item[data-value="${a}"]`);u&&(c.textContent=u.textContent,d.querySelectorAll(".dropdown-item").forEach(f=>f.classList.remove("selected")),u.classList.add("selected"))}};i($[0],t.aspect_ratio),i($[1],t.resolution),i($[2],t.frame_rate),i($[3],t.platform_preset),he()}function he(){const i=L.getParams().platform_preset,o=L.modelService,a=o.supports(i,"supportsNegativePrompt");document.querySelectorAll(".scene-negative-prompt").forEach(l=>{const c=l.closest(".form-group");if(c){const u=c.previousElementSibling;a?(c.classList.remove("hidden"),u&&u.classList.remove("no-separator")):(c.classList.add("hidden"),u&&u.classList.add("no-separator"))}});const d=o.supports(i,"supportsCameraControls");document.querySelectorAll(".scene-camera-input").forEach(l=>{const c=l.closest(".form-group");c&&(d?(c.classList.remove("disabled-group"),l.disabled=!1,c.style.opacity="1",c.style.pointerEvents="auto"):(c.classList.add("disabled-group"),l.disabled=!0,c.style.opacity="0.5",c.style.pointerEvents="none"))})}window.addEventListener("global-params-corrected",t=>{const i=t.detail.violations,o=i.map(a=>`â€¢ ${a.message}`).join("<br>");showToast("Settings Adjusted",o,"warning",6e3),g.trackEvent("settings_auto_adjusted",{violation_count:i.length}),pe(),he()}),pe();const De=document.getElementById("reset-global-params");De&&De.addEventListener("click",()=>{confirm("Reset all global parameters to defaults?")&&(L.resetDefaults(),pe(),showToast("Global Parameters Reset","All global settings have been restored to defaults.","info"))});let te=1;n.addEventListener("click",()=>{te++;const t=te;g.trackEvent("add_scene",{scene_id:t});const i=`
            <div class="scene-item" data-scene-id="${t}">
                <div class="scene-header">
                    <h4 class="scene-title" style="margin: 0; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Scene ${t}</h4>
                    <div class="scene-actions">
                        <button class="scene-undo-btn hidden" title="Undo AI Enhancement">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10h10a5 5 0 0 1 5 5v2"/><path d="m3 10 6 6"/><path d="m3 10 6-6"/></svg>
                        </button>
                        <button class="scene-redo-btn hidden" title="Redo AI Enhancement">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10H11a5 5 0 0 0-5 5v2"/><path d="m21 10-6 6"/><path d="m21 10-6-6"/></svg>
                        </button>
                        <button class="scene-enhance-btn" title="Enhance with AI">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="enhance-stars-icon">
                                <path d="M15.5 5.5 L16.8 10.2 L21.5 11.5 L16.8 12.8 L15.5 17.5 L14.2 12.8 L9.5 11.5 L14.2 10.2 Z" />
                                <path d="M5.5 2.5 L6.2 4.8 L8.5 5.5 L6.2 6.2 L5.5 8.5 L4.8 6.2 L2.5 5.5 L4.8 4.8 Z" />
                                <path d="M6.5 15.5 L7.2 17.8 L9.5 18.5 L7.2 19.2 L6.5 21.5 L5.8 19.2 L3.5 18.5 L5.8 17.8 Z" />
                            </svg>
                        </button>
                        <button class="remove-scene-btn" onclick="removeScene(this)" title="Remove Scene">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Scene Description</label>
                    <textarea class="scene-description" placeholder="Describe your scene in detail..." style="min-height: 100px;"></textarea>
                </div>
                <div class="scene-params-grid">
                <div class="form-group">
                    <label class="section-label">Camera Angle</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-camera-input" 
                            placeholder="Select angle or type custom..."
                            aria-label="Camera Angle">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open camera presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="pan_left">Pan Left</div>
                                <div class="dropdown-item" data-value="pan_right">Pan Right</div>
                                <div class="dropdown-item" data-value="zoom_in">Zoom In</div>
                                <div class="dropdown-item" data-value="zoom_out">Zoom Out</div>
                                <div class="dropdown-item" data-value="dolly_zoom">Dolly Zoom</div>
                                <div class="dropdown-item" data-value="tracking_shot">Track</div>
                                <div class="dropdown-item" data-value="eye_level">Eye Level</div>
                                <div class="dropdown-item" data-value="low_angle">Low Angle</div>
                                <div class="dropdown-item" data-value="high_angle">High Angle</div>
                                <div class="dropdown-item" data-value="aerial_view">Aerial View</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Lighting Style</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-lighting-input" 
                            placeholder="Select lighting or type custom..."
                            aria-label="Lighting Style">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open lighting presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="natural">Natural</div>
                                <div class="dropdown-item" data-value="golden_hour">Golden Hour</div>
                                <div class="dropdown-item" data-value="blue_hour">Blue Hour</div>
                                <div class="dropdown-item" data-value="neon">Neon Cyberpunk</div>
                                <div class="dropdown-item" data-value="studio">Studio</div>
                                <div class="dropdown-item" data-value="dramatic">Dramatic</div>
                                <div class="dropdown-item" data-value="cinematic">Cinematic</div>
                                <div class="dropdown-item" data-value="softbox">Softbox</div>
                                <div class="dropdown-item" data-value="backlit">Backlit</div>
                                <div class="dropdown-item" data-value="rim_light">Rim Light</div>
                            </div>
                        </div>
                    </div>
                <div class="form-group">
                    <label class="section-label">Color Palettes</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-color-input" placeholder="Select palette or type custom..." aria-label="Color Palette">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open color presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="monochromatic">Monochromatic</div>
                                <div class="dropdown-item" data-value="complementary">Complementary</div>
                                <div class="dropdown-item" data-value="analogous">Analogous</div>
                                <div class="dropdown-item" data-value="teal_orange">Cinematic Teal & Orange</div>
                                <div class="dropdown-item" data-value="cyberpunk">Cyberpunk Glow</div>
                                <div class="dropdown-item" data-value="sepia">Sepia Tone</div>
                                <div class="dropdown-item" data-value="vibrant">High Saturation</div>
                                <div class="dropdown-item" data-value="desaturated">Moody Desaturated</div>
                                <div class="dropdown-item" data-value="pastel">Pastel Tones</div>
                                <div class="dropdown-item" data-value="bw">Classic B&W</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Mood Descriptors</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-mood-input" placeholder="Select mood or type custom..." aria-label="Mood Descriptors">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open mood presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="ethereal">Ethereal/Dreamy</div>
                                <div class="dropdown-item" data-value="ominous">Dark/Ominous</div>
                                <div class="dropdown-item" data-value="energetic">High Energy</div>
                                <div class="dropdown-item" data-value="calm">Calm/Peaceful</div>
                                <div class="dropdown-item" data-value="nostalgic">Nostalgic</div>
                                <div class="dropdown-item" data-value="cyberpunk">Cyberpunk/Neon</div>
                                <div class="dropdown-item" data-value="epic">Epic/Cinematic</div>
                                <div class="dropdown-item" data-value="suspenseful">Suspenseful</div>
                                <div class="dropdown-item" data-value="melancholic">Melancholic</div>
                                <div class="dropdown-item" data-value="whimsical">Whimsical</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Sound Design</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-sound-input" placeholder="Describe sound or select presets..." aria-label="Sound Design">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open sound presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="ambient_wind">Ambient Wind</div>
                                <div class="dropdown-item" data-value="orchestral">Cinematic Orchestral</div>
                                <div class="dropdown-item" data-value="low_hum">Low Hum</div>
                                <div class="dropdown-item" data-value="nature">Nature Sounds</div>
                                <div class="dropdown-item" data-value="urban_traffic">Urban Traffic</div>
                                <div class="dropdown-item" data-value="synthwave">80s Synth</div>
                                <div class="dropdown-item" data-value="industrial">Heavy Industrial</div>
                                <div class="dropdown-item" data-value="silence">Deep Silence</div>
                                <div class="dropdown-item" data-value="asmr">ASMR Rustle</div>
                                <div class="dropdown-item" data-value="glitch">Glitchy Beats</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Negative Prompts</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-negative-prompt" 
                            placeholder="Type elements to exclude or select from presets..."
                            aria-label="Custom negative prompts">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger" aria-label="Open presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="blurry">Blurry</div>
                                <div class="dropdown-item" data-value="low_res">Low Res</div>
                                <div class="dropdown-item" data-value="deformed">Deformed</div>
                                <div class="dropdown-item" data-value="watermark">Watermark</div>
                                <div class="dropdown-item" data-value="flicker">Flicker</div>
                                <div class="dropdown-item" data-value="grainy">Grainy</div>
                                <div class="dropdown-item" data-value="overexposed">Overexposed</div>
                                <div class="dropdown-item" data-value="extra_limbs">Extra Limbs</div>
                                <div class="dropdown-item" data-value="distorted">Distorted</div>
                                <div class="dropdown-item" data-value="unrealistic">Unrealistic</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Composition Principles</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-composition-input"
                            placeholder="Select composition or type custom..."
                            aria-label="Composition Principles">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger"
                                aria-label="Open composition presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="rule_of_thirds">Rule of Thirds</div>
                                <div class="dropdown-item" data-value="center_framed">Center Framed</div>
                                <div class="dropdown-item" data-value="leading_lines">Leading Lines</div>
                                <div class="dropdown-item" data-value="golden_ratio">Golden Ratio</div>
                                <div class="dropdown-item" data-value="negative_space">Negative Space</div>
                                <div class="dropdown-item" data-value="symmetrical">Symmetrical</div>
                                <div class="dropdown-item" data-value="asymmetrical">Asymmetrical</div>
                                <div class="dropdown-item" data-value="depth_of_field">Depth of Field</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Lens Techniques</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-lens-input"
                            placeholder="Select lens or type custom..." aria-label="Lens Techniques">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger"
                                aria-label="Open lens presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="macro">Macro</div>
                                <div class="dropdown-item" data-value="wide_angle">Wide Angle</div>
                                <div class="dropdown-item" data-value="telephoto">Telephoto</div>
                                <div class="dropdown-item" data-value="fisheye">Fisheye</div>
                                <div class="dropdown-item" data-value="bokeh">Bokeh</div>
                                <div class="dropdown-item" data-value="tilt_shift">Tilt Shift</div>
                                <div class="dropdown-item" data-value="anamorphic">Anamorphic</div>
                                <div class="dropdown-item" data-value="prime_lens">Prime Lens</div>
                                <div class="dropdown-item" data-value="zoom_lens">Zoom Lens</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Production Design</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-production-input"
                            placeholder="Select style or type custom..." aria-label="Production Design">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger"
                                aria-label="Open production presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="minimalist">Minimalist</div>
                                <div class="dropdown-item" data-value="brutalist">Brutalist</div>
                                <div class="dropdown-item" data-value="futuristic">Futuristic</div>
                                <div class="dropdown-item" data-value="retro_vintage">Retro/Vintage</div>
                                <div class="dropdown-item" data-value="industrial">Industrial</div>
                                <div class="dropdown-item" data-value="gothic">Gothic</div>
                                <div class="dropdown-item" data-value="art_deco">Art Deco</div>
                                <div class="dropdown-item" data-value="cyberpunk">Cyberpunk</div>
                                <div class="dropdown-item" data-value="steampunk">Steampunk</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="section-label">Editing Techniques</label>
                    <div class="input-with-dropdown">
                        <input type="text" class="scene-editing-input"
                            placeholder="Select technique or type custom..."
                            aria-label="Editing Techniques">
                        <div class="input-dropdown-wrapper">
                            <button type="button" class="input-dropdown-trigger"
                                aria-label="Open editing presets">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="input-dropdown-menu">
                                <div class="dropdown-item" data-value="fast_cut">Fast Cut</div>
                                <div class="dropdown-item" data-value="slow_motion">Slow Motion</div>
                                <div class="dropdown-item" data-value="jump_cut">Jump Cut</div>
                                <div class="dropdown-item" data-value="cross_dissolve">Cross Dissolve</div>
                                <div class="dropdown-item" data-value="match_cut">Match Cut</div>
                                <div class="dropdown-item" data-value="fade_to_black">Fade to Black</div>
                                <div class="dropdown-item" data-value="long_take">Long Take</div>
                                <div class="dropdown-item" data-value="montage">Montage</div>
                                <div class="dropdown-item" data-value="time_lapse">Time Lapse</div>
                            </div>
                        </div>
                    </div>
                </div>
                </div> <!-- End scene-params-grid -->
            </div>
        `;e.insertAdjacentHTML("beforeend",i),he()}),e.addEventListener("click",t=>{const i=t.target.closest(".input-dropdown-trigger");if(i){t.stopPropagation();const a=i.closest(".input-dropdown-wrapper");document.querySelectorAll(".input-dropdown-wrapper.open").forEach(d=>{d!==a&&d.classList.remove("open")}),a.classList.toggle("open")}const o=t.target.closest(".input-dropdown-menu .dropdown-item");if(o){t.stopPropagation();const a=o.closest(".input-dropdown-wrapper"),d=a.closest(".input-with-dropdown").querySelector("input"),l=o.textContent.trim();let c=d.value.trim();c?c.split(",").map(f=>f.trim().toLowerCase()).includes(l.toLowerCase())||(d.value=`${c}, ${l}`):d.value=l,a.classList.remove("open"),d.focus()}}),document.addEventListener("click",()=>{document.querySelectorAll(".input-dropdown-wrapper.open").forEach(t=>{t.classList.remove("open")})}),window.removeScene=function(t){const i=t.closest(".scene-item");i&&(i.remove(),yt())};function yt(){const t=e.querySelectorAll(".scene-item");t.forEach((i,o)=>{const a=i.querySelector("h4");a&&(a.textContent=`Scene ${o+1}`)}),te=t.length}const je=document.getElementById("reset-btn");je&&je.addEventListener("click",()=>{var t,i;if(confirm("Are you sure you want to reset the generator? All current work will be lost.")){g.trackEvent("reset_generator");const o=e.querySelector('.scene-item[data-scene-id="1"]');o&&(o.querySelector(".scene-description").value="",o.querySelector(".scene-negative-prompt").value="",o.querySelector(".scene-camera-input").value="",o.querySelector(".scene-lighting-input").value="",o.querySelector(".scene-color-input").value="",o.querySelector(".scene-mood-input").value="",o.querySelector(".scene-sound-input").value="",o.querySelector(".scene-composition-input").value="",o.querySelector(".scene-lens-input").value="",o.querySelector(".scene-production-input").value="",o.querySelector(".scene-editing-input").value="",(t=o.querySelector(".scene-undo-btn"))==null||t.classList.add("hidden"),(i=o.querySelector(".scene-redo-btn"))==null||i.classList.add("hidden")),e.querySelectorAll('.scene-item:not([data-scene-id="1"])').forEach(d=>d.remove()),te=1,r.value=JSON.stringify({platform:"veo",prompt:"Waiting for input...",parameters:{aspect_ratio:"16:9",resolution:"1080p"}},null,2),showToast("Generator Reset","All scenes and outputs have been cleared.","info")}}),s.addEventListener("click",async()=>{s.classList.add("loading"),await new Promise(t=>setTimeout(t,600));try{const t=[];if(e.querySelectorAll(".scene-item").forEach(u=>{var ut,pt,ht,gt;const f=u.querySelector(".scene-description").value,v=u.querySelector(".scene-camera-input").value.trim(),w=u.querySelector(".scene-lighting-input").value.trim(),S=u.querySelector(".scene-color-input").value.trim(),M=u.querySelector(".scene-mood-input").value.trim(),X=u.querySelector(".scene-sound-input").value.trim(),ee=((ut=u.querySelector(".scene-composition-input"))==null?void 0:ut.value.trim())||"",H=((pt=u.querySelector(".scene-lens-input"))==null?void 0:pt.value.trim())||"",Se=((ht=u.querySelector(".scene-production-input"))==null?void 0:ht.value.trim())||"",Bt=((gt=u.querySelector(".scene-editing-input"))==null?void 0:gt.value.trim())||"",At=u.querySelector(".scene-negative-prompt").value.trim();f.trim()&&t.push({description:f.trim(),negative_prompt:At||null,parameters:{camera:v||null,lighting:w||null,color_palette:S||null,mood:M||null,sound_design:X||null,composition:ee||null,lens_technique:H||null,production_design:Se||null,editing_technique:Bt||null}})}),t.length===0){showToast("Empty Prompt","Please add at least one scene description.","warning");return}const o=L.modelService.validateContent(JSON.stringify(t));if(!o.safe){showToast("Safety Violation",`Content contains prohibited terms: ${o.flagged.join(", ")}`,"error");return}const a=document.querySelector('input[name="gen-mode"]:checked'),d=a?a.value:"json",l=L.getParams(),c={platform:l.platform_preset,version:"1.0",scenes:[],global_parameters:{aspect_ratio:l.aspect_ratio,resolution:l.resolution,frame_rate:l.frame_rate}};if(d==="ai"){const u=x.getConfiguredProviders();if(u.length===0){showToast("Configuration Required","Please configure an AI provider in the integration hub first.","warning");return}const f=u[0];s.disabled=!0;try{const v=await x.generateFullJson(f,t);let w;try{w=JSON.parse(v)}catch{throw new Error("Failed to parse AI response as valid JSON.")}c.scenes=w;const S=L.modelService.formatPayload(l.platform_preset,c);r.value=JSON.stringify(S,null,2),A&&A.save(S,"ai"),g.trackGeneration(t.length,"ai",l.platform_preset),showToast("AI Generation Complete","Enhanced JSON prompt generated successfully!","success"),document.getElementById("output-section").classList.remove("hidden"),document.getElementById("output-section").scrollIntoView({behavior:"smooth",block:"start"})}catch(v){console.error("AI Gen Error:",v),showToast("Generation Failed",v.message,"error")}finally{s.disabled=!1}}else{c.scenes=t;const u=L.modelService.formatPayload(l.platform_preset,c);r.value=JSON.stringify(u,null,2),A&&A.save(u,"json"),g.trackGeneration(t.length,"json",l.platform_preset),showToast("Success","JSON generated successfully!","success"),document.getElementById("output-section").classList.remove("hidden"),document.getElementById("output-section").scrollIntoView({behavior:"smooth",block:"start"})}}catch(t){console.error("Generation Error:",t),showToast("Error","An unexpected error occurred.","error")}finally{s.classList.remove("loading")}}),document.getElementById("copy-btn").addEventListener("click",()=>{const t=r.value;if(!t||t.includes("Waiting for input...")){showToast("No Content","Generate a prompt first.","warning");return}navigator.clipboard.writeText(t).then(()=>{showToast("Copied","JSON prompt copied to clipboard!","success"),g.trackEvent("copy_json")}).catch(i=>{showToast("Error","Failed to copy to clipboard.","error")})}),document.getElementById("download-btn").addEventListener("click",()=>{const t=r.value;if(!t||t.includes("Waiting for input...")){showToast("No Content","Generate a prompt first.","warning");return}const i=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download=`veo-prompt-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),showToast("Downloaded","JSON file downloaded successfully.","success"),g.trackEvent("download_json")});const k=new Ot;document.getElementById("dictionary-section");const wt=document.getElementById("generator-section");document.getElementById("output-section");const K=document.querySelectorAll(".main-nav a"),P=document.getElementById("dict-content"),B=document.getElementById("dict-category-list"),He=document.getElementById("dict-search"),ie=document.getElementById("dict-active-category-title"),z=document.getElementById("dict-sidebar"),O=document.getElementById("dict-sidebar-overlay"),Ge=document.getElementById("dict-hamburger-btn"),$e=document.getElementById("dict-sidebar-close");function bt(){z==null||z.classList.add("active"),O==null||O.classList.add("active")}function Le(){z==null||z.classList.remove("active"),O==null||O.classList.remove("active")}Ge&&Ge.addEventListener("click",bt),$e&&$e.addEventListener("click",Le),O&&O.addEventListener("click",Le);const x=new Rt,St=document.getElementById("llm-section"),Ue=document.getElementById("ai-enhance-btn"),ge=document.getElementById("llm-key-modal"),Fe=document.getElementById("llm-modal-close-btn"),Ve=document.getElementById("key-modal-cancel"),Je=document.getElementById("key-modal-save"),xe=document.getElementById("provider-api-key"),U=document.getElementById("key-validation-status"),Ke=document.querySelectorAll(".provider-card"),W=document.querySelector(".usage-dashboard");let ne=null,F=null;x.init().then(()=>{_e()});const Y=document.getElementById("contribution-modal"),ze=document.getElementById("dict-contribute-btn"),We=document.getElementById("modal-close-btn"),Ye=document.getElementById("modal-cancel-btn"),ve=document.getElementById("modal-submit-btn");document.getElementById("contrib-category"),document.getElementById("new-category-check");const V=document.getElementById("new-category-name"),Z=document.getElementById("contrib-difficulty-pills");let q=null;const fe=document.getElementById("toggle-api-key");fe&&fe.addEventListener("click",()=>{const t=document.getElementById("provider-api-key"),i=fe.querySelector(".eye-icon"),o=fe.querySelector(".eye-off-icon");t.type==="password"?(t.type="text",i.classList.add("hidden"),o.classList.remove("hidden")):(t.type="password",i.classList.remove("hidden"),o.classList.add("hidden"))});function Ce(t){var d,l;if(!t)return;g.trackEvent("section_view",{section:t}),document.querySelectorAll(".main-nav a").forEach(c=>{c.dataset.section===t?c.classList.add("active"):c.classList.remove("active")}),document.querySelectorAll(".sidebar-link").forEach(c=>{c.dataset.section===t?c.classList.add("active"):c.classList.remove("active")}),document.querySelectorAll("section").forEach(c=>c.classList.add("hidden"));const i=document.querySelector(".hero-section"),o=document.querySelector(".dict-hero");i==null||i.classList.add("hidden"),o==null||o.classList.add("hidden");const a=document.getElementById(t);a&&a.classList.remove("hidden"),t==="generator-section"?(i==null||i.classList.remove("hidden"),(d=document.getElementById("global-params-section"))==null||d.classList.remove("hidden"),(l=document.getElementById("output-section"))==null||l.classList.remove("hidden")):t==="dictionary-section"?(o==null||o.classList.remove("hidden"),k.isInitialized||k.init().then(()=>{Ie(),Te(),setTimeout(()=>{const c=B==null?void 0:B.querySelector("li");c&&c.querySelector(".category-name").click()},100)})):t==="llm-section"?_e():t==="history-section"&&typeof j=="function"&&j("section")}window.switchSection=Ce,K.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault();const o=t.dataset.section;Ce(o)})});function Ie(){if(!B)return;B.innerHTML="",k.getAllCategories().forEach(i=>{const o=document.createElement("li"),a=k.isCategoryUserCreated(i.id);a&&o.classList.add("user-category");const d=document.createElement("span");if(d.textContent=i.name,d.className="category-name",o.appendChild(d),a){const l=document.createElement("button");l.className="category-delete-btn",l.title="Delete Category",l.innerHTML=`
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                `,l.addEventListener("click",c=>{c.stopPropagation(),Ct(i.id)}),o.appendChild(l)}o.dataset.catId=i.id,d.addEventListener("click",()=>{B.querySelectorAll("li").forEach(l=>l.classList.remove("active")),o.classList.add("active"),q=i.id,ie.textContent=i.name,se(i.id),Le()}),B.appendChild(o)})}function se(t){if(P.innerHTML="",!t){P.innerHTML='<div class="empty-state">Select a category from the sidebar to view terms</div>';return}k.getTermsByCategory(t).forEach(o=>{const a=Ze(o);P.appendChild(a)})}function Ze(t){const i=document.createElement("div"),o=k.isUserCreated(t.id);i.className=`term-card ${o?"user-term":""}`,i.dataset.termId=t.id;const a=t.examples&&t.examples.length>0?`<div class="term-examples">
                <h5>Examples:</h5>
                <ul>${t.examples.map(w=>`<li>${w}</li>`).join("")}</ul>
               </div>`:"",d=t.difficulty||"beginner",l=t.author||"System",c=t.likes||0,u=o?`
            <button class="term-manage-btn edit-btn" data-term-id="${t.id}" title="Edit Term">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
            <button class="term-manage-btn delete-btn" data-term-id="${t.id}" title="Delete Term">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            </button>
        `:"";i.innerHTML=`
            <div class="term-header">
                <h4 class="term-title">${t.name}</h4>
                <div class="term-header-right">
                    <span class="difficulty-badge ${d}">${d}</span>
                    ${u}
                </div>
            </div>
            <p class="term-definition">${t.definition}</p>
            ${a}
            <div class="term-footer">
                <div class="term-author">By: <span>@${l}</span></div>
                <div class="term-actions">
                    <button class="term-action-btn like-btn" data-term-id="${t.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                        <span class="like-count">${c}</span>
                    </button>
                    <button class="btn-use-prompt" data-term-name="${t.name}">Use in Prompt</button>
                </div>
            </div>
        `;const f=i.querySelector(".like-btn");return f.addEventListener("click",()=>kt(t.id,f)),i.querySelector(".btn-use-prompt").addEventListener("click",()=>Et(t.name)),o&&(i.querySelector(".edit-btn").addEventListener("click",()=>Lt(t.id)),i.querySelector(".delete-btn").addEventListener("click",()=>xt(t.id))),i}function kt(t,i){i.classList.toggle("liked");const o=i.querySelector(".like-count");g.trackEvent("dict_like_term",{term_id:t,liked:i.classList.contains("liked")});let a=parseInt(o.textContent)||0;i.classList.contains("liked")?a++:a=Math.max(0,a-1),o.textContent=a;const d=JSON.parse(localStorage.getItem("likedTerms")||"[]");if(i.classList.contains("liked"))d.includes(t)||d.push(t);else{const l=d.indexOf(t);l>-1&&d.splice(l,1)}localStorage.setItem("likedTerms",JSON.stringify(d))}function Et(t){var o,a,d;const i=document.querySelector(".scene-description");if(i){const l=i.value;i.value=l?`${l}, ${t}`:t,g.trackEvent("dict_use_term",{term_name:t}),i.dispatchEvent(new Event("input",{bubbles:!0}));const c=Array.from(K).find(u=>u.textContent.trim()==="JSON Generator");c?c.click():(document.querySelectorAll("section").forEach(u=>u.classList.add("hidden")),wt.classList.remove("hidden"),(o=document.getElementById("global-params-section"))==null||o.classList.remove("hidden"),(a=document.getElementById("output-section"))==null||a.classList.remove("hidden"),(d=document.querySelector(".hero-section"))==null||d.classList.remove("hidden"),K.forEach(u=>u.classList.remove("active")),K[0]&&K[0].classList.add("active")),typeof showToast=="function"&&showToast("Term Applied",`"${t}" added to scene 1`,"success")}else{const l=Array.from(K).find(c=>c.textContent.trim()==="JSON Generator");l&&l.click(),typeof showToast=="function"&&showToast("No Active Scene","Add a scene first to use dictionary terms.","warning")}}let ye=null,Q=null;function Lt(t){const i=k.getTermById(t);if(!i)return;const{term:o,categoryId:a}=i;ye=t,Q=a,document.getElementById("contrib-username").value=o.author||"",document.getElementById("contrib-term-name").value=o.name||"",document.getElementById("contrib-definition").value=o.definition||"",document.getElementById("contrib-examples").value=o.examples?o.examples.join(", "):"",R=a;const d=k.getAllCategories().find(c=>c.id===a);d&&(we.textContent=d.name),Z.querySelectorAll(".pill").forEach(c=>{c.classList.remove("active"),c.dataset.value===o.difficulty&&c.classList.add("active")}),document.querySelector(".modal-header h3").textContent="Edit Term",ve.textContent="Update Term",Y.classList.remove("hidden")}function xt(t){if(!confirm("Are you sure you want to delete this term? This action cannot be undone."))return;const i=k.getTermById(t);if(!i)return;const{categoryId:o}=i;k.deleteTerm(o,t)&&(g.trackEvent("dict_delete_term",{term_id:t,category_id:o}),q===o&&se(o))}function Ct(t){const i=k.getAllCategories().find(a=>a.id===t),o=i?i.name:"this category";confirm(`Are you sure you want to delete "${o}"? All terms in this category will also be deleted. This action cannot be undone.`)&&k.deleteCategory(t)&&(Ie(),Te(),q===t&&(q=null,ie.textContent="Select a Category",P.innerHTML='<div class="empty-state">Select a category from the sidebar to view terms</div>'))}He&&He.addEventListener("input",t=>{const i=t.target.value.trim();if(i.length>0){B==null||B.querySelectorAll("li").forEach(a=>a.classList.remove("active")),ie.textContent=`Search: "${i}"`;const o=k.searchTerm(i);g.trackEvent("dict_search",{query:i,result_count:o.length}),It(o)}else if(q){const o=k.getAllCategories().find(a=>a.id===q);ie.textContent=o?o.name:"Select a Category",se(q)}else ie.textContent="Select a Category",P.innerHTML='<div class="empty-state">Select a category from the sidebar to view terms</div>'});function It(t){if(P.innerHTML="",t.length===0){P.innerHTML='<div class="empty-state">No terms found matching your query.</div>';return}t.forEach(i=>{const o=document.createElement("div");o.className="search-category-header",o.textContent=i.categoryName,P.appendChild(o),i.terms.forEach(a=>{const d=Ze(a);P.appendChild(d)})})}ze&&ze.addEventListener("click",()=>{ae(),g.trackEvent("dict_contribute_click"),Y.classList.remove("hidden")});const oe=document.getElementById("custom-category-dropdown"),Qe=document.getElementById("dropdown-trigger"),I=document.getElementById("dropdown-menu"),we=document.querySelector(".dropdown-value");let R=null;Qe&&Qe.addEventListener("click",t=>{t.stopPropagation(),oe.classList.toggle("open"),I.classList.toggle("hidden")}),document.addEventListener("click",t=>{oe&&!oe.contains(t.target)&&(oe.classList.remove("open"),I==null||I.classList.add("hidden"))}),Z&&Z.addEventListener("click",t=>{t.target.classList.contains("pill")&&(Z.querySelectorAll(".pill").forEach(i=>i.classList.remove("active")),t.target.classList.add("active"))});function Te(){if(!I)return;I.innerHTML="",k.getAllCategories().forEach(o=>{const a=document.createElement("div");a.className="dropdown-item",a.dataset.categoryId=o.id,a.textContent=o.name,o.id===R&&a.classList.add("selected"),I.appendChild(a)});const i=document.createElement("div");i.className="dropdown-item new-category-btn",i.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create New Category
        `,I.appendChild(i)}I&&I.addEventListener("click",t=>{const i=t.target.closest(".dropdown-item");if(i){if(i.classList.contains("new-category-btn"))we.textContent="New Category",R=null,V.classList.remove("hidden"),V.focus();else{const o=i.dataset.categoryId,a=i.textContent;I.querySelectorAll(".dropdown-item").forEach(d=>d.classList.remove("selected")),i.classList.add("selected"),we.textContent=a,R=o,V.classList.add("hidden")}oe.classList.remove("open"),I.classList.add("hidden")}}),ve&&ve.addEventListener("click",()=>{const t=document.getElementById("contrib-username").value.trim()||"Anonymous",i=document.getElementById("contrib-term-name").value.trim(),o=document.getElementById("contrib-definition").value.trim(),a=document.getElementById("contrib-examples").value.trim(),d=Z.querySelector(".pill.active"),l=d?d.dataset.value:"beginner";if(!i||!o){showToast("Fields Required","Please fill in both the term name and its definition.","warning");return}const c=a?a.split(",").map(u=>u.trim()):[];if(ye&&Q){const u={name:i,definition:o,difficulty:l,examples:c,author:t.replace("@","")};k.editTerm(Q,ye,u)&&(q===Q&&se(Q),ae(),Y.classList.add("hidden"))}else{let u;if(!R&&!V.classList.contains("hidden")){const v=V.value.trim();if(!v){showToast("Category Name Required","Please enter a name for the new category.","warning");return}u="user_"+v.toLowerCase().replace(/\s+/g,"_"),k.addCategory({id:u,name:v,author:t,terms:[]}),Ie(),Te()}else if(R)u=R;else{showToast("Category Selection Required","Please select a category from the dropdown.","warning");return}const f={id:"user_"+Date.now(),name:i,definition:o,difficulty:l,examples:c,author:t.replace("@",""),likes:0};k.addTerm(u,f),q===u&&se(u),ae(),Y.classList.add("hidden")}});function ae(){ye=null,Q=null,document.querySelector(".modal-header h3").textContent="Contribute a Term",ve.textContent="Submit Term",document.getElementById("contrib-username").value="",document.getElementById("contrib-term-name").value="",document.getElementById("contrib-definition").value="",document.getElementById("contrib-examples").value="",V.value="",V.classList.add("hidden"),R=null,we.textContent="Select a category",Z.querySelectorAll(".pill").forEach(t=>t.classList.remove("active"))}We&&We.addEventListener("click",()=>{ae(),Y.classList.add("hidden")}),Ye&&Ye.addEventListener("click",()=>{ae(),Y.classList.add("hidden")});function _e(){if(!St)return;const t=x.getConfiguredProviders();Ke.forEach(a=>{const d=a.dataset.provider,l=a.querySelector(".provider-setup-status"),c=a.querySelector(".setup-key-btn");t.includes(d)?(l.textContent="CONFIGURED",l.classList.add("configured"),c.textContent="Update Key"):(l.textContent="NOT CONFIGURED",l.classList.remove("configured"),c.textContent="Setup API Key")}),Ue&&(Ue.style.display=t.length>0?"flex":"none");const i=x.getUsageStats(),o=Object.keys(i).length>0;if(W==null||W.classList.toggle("hidden",!o),o&&W){const a=W.querySelector(".usage-stats-grid"),d=W.querySelector(".usage-total-tokens");a.innerHTML="";let l=0;for(const[c,u]of Object.entries(i)){l+=u.requestCount;const f=u.lastUsed?new Date(u.lastUsed).toLocaleDateString():"Never",v=document.createElement("div");v.className="stat-box",v.innerHTML=`
                    <div class="stat-header">
                        <div class="stat-provider">${x.providers[c].name}</div>
                        <div class="stat-indicator"></div>
                    </div>
                    <div class="stat-main">
                        <div class="stat-value">${u.requestCount}<span class="stat-unit">Requests</span></div>
                    </div>
                    <div class="stat-footer">
                        <div class="stat-info">
                            <span>Active Model</span>
                            <span>${u.model||"Default"}</span>
                        </div>
                        <div class="stat-info">
                            <span>Last Used</span>
                            <span>${f}</span>
                        </div>
                    </div>
                `,a.appendChild(v)}d&&(d.textContent=`Total Requests: ${l}`)}}function Tt(t){ne=t;const i=x.providers[t];document.getElementById("modal-provider-name").textContent=`Configure ${i.name}`,xe.value=x.getProviderKey(t)||"";const o=document.querySelector("#llm-provider-dropdown .dropdown-value");o&&(o.textContent=i.name),document.querySelectorAll("#llm-provider-dropdown .dropdown-item").forEach(l=>{l.classList.toggle("selected",l.dataset.providerId===t)}),U.classList.add("hidden"),U.classList.remove("success","error");const a=document.getElementById("provider-api-key");a.type="password";const d=document.getElementById("toggle-api-key");d&&(d.querySelector(".eye-icon").classList.remove("hidden"),d.querySelector(".eye-off-icon").classList.add("hidden")),document.getElementById("custom-model-group").classList.add("hidden"),document.getElementById("custom-model-id").value="",Xe(t),ge.classList.remove("hidden")}function Xe(t){const i=document.getElementById("model-dropdown-menu"),o=document.querySelector("#llm-model-dropdown .dropdown-value"),a=document.getElementById("custom-model-group"),d=document.getElementById("custom-model-id"),l=x.providers[t],c=x.config[t],u=(c==null?void 0:c.model)||l.models[0].id,f=l.models.some(w=>w.id===u);i.innerHTML="",l.models.forEach(w=>{const S=document.createElement("div");S.className="dropdown-item",w.id===u&&(S.classList.add("selected"),o.textContent=w.name,F=w.id),S.textContent=w.name,S.dataset.modelId=w.id,S.addEventListener("click",()=>{i.querySelectorAll(".dropdown-item").forEach(M=>M.classList.remove("selected")),S.classList.add("selected"),o.textContent=w.name,F=w.id,a.classList.add("hidden"),document.getElementById("model-dropdown-menu").classList.add("hidden"),document.getElementById("llm-model-dropdown").classList.remove("open")}),i.appendChild(S)});const v=document.createElement("div");v.className="dropdown-item",v.textContent="Custom Model",v.dataset.modelId="custom",f||(v.classList.add("selected"),o.textContent="Custom Model",F="custom",a.classList.remove("hidden"),d.value=u),v.addEventListener("click",()=>{i.querySelectorAll(".dropdown-item").forEach(w=>w.classList.remove("selected")),v.classList.add("selected"),o.textContent="Custom Model",F="custom",a.classList.remove("hidden"),d.focus(),document.getElementById("model-dropdown-menu").classList.add("hidden"),document.getElementById("llm-model-dropdown").classList.remove("open")}),i.appendChild(v)}Ke.forEach(t=>{t.querySelector(".setup-key-btn").addEventListener("click",()=>{Tt(t.dataset.provider)})}),Fe&&Fe.addEventListener("click",()=>ge.classList.add("hidden")),Ve&&Ve.addEventListener("click",()=>ge.classList.add("hidden")),Je&&Je.addEventListener("click",async()=>{const t=xe.value.trim();let i=F;if(!t){showToast("Input Required","Please enter an API key","warning");return}if(F==="custom"){const a=document.getElementById("custom-model-id").value.trim();if(!a){showToast("Input Required","Please enter a custom model ID","warning");return}i=a}U.classList.remove("hidden"),U.innerHTML='<div class="loader-small"></div><span>Validating key...</span>';const o=await x.validateKey(ne,t);U.innerHTML=`<span>${o.message}</span>`,U.classList.replace("hidden",o.valid?"success":"error"),o.valid||U.classList.add("error"),g.trackEvent("llm_setup_attempt",{provider:ne,success:o.valid,model_type:F==="custom"?"custom":"preset"}),o.valid&&(await x.setProviderKey(ne,t,i),setTimeout(()=>{ge.classList.add("hidden"),_e()},1e3))});const Be=[{triggerId:"provider-dropdown-trigger",menuId:"provider-dropdown-menu",wrapperId:"llm-provider-dropdown"},{triggerId:"model-dropdown-trigger",menuId:"model-dropdown-menu",wrapperId:"llm-model-dropdown"}];Be.forEach(t=>{const i=document.getElementById(t.triggerId);i&&i.addEventListener("click",o=>{o.stopPropagation(),Be.forEach(a=>{if(a.triggerId!==t.triggerId){const d=document.getElementById(a.menuId),l=document.getElementById(a.wrapperId);d&&d.classList.add("hidden"),l&&l.classList.remove("open")}}),document.getElementById(t.wrapperId).classList.toggle("open"),document.getElementById(t.menuId).classList.toggle("hidden")})}),document.querySelectorAll("#llm-provider-dropdown .dropdown-item").forEach(t=>{t.addEventListener("click",()=>{const i=t.dataset.providerId,o=t.textContent;document.querySelector("#llm-provider-dropdown .dropdown-value").textContent=o,document.querySelectorAll("#llm-provider-dropdown .dropdown-item").forEach(a=>a.classList.remove("selected")),t.classList.add("selected"),ne=i,xe.value=x.getProviderKey(i)||"",Xe(i),document.getElementById("provider-dropdown-menu").classList.add("hidden"),document.getElementById("llm-provider-dropdown").classList.remove("open")})}),document.addEventListener("click",()=>{Be.forEach(t=>{const i=document.getElementById(t.menuId),o=document.getElementById(t.wrapperId);i&&i.classList.add("hidden"),o&&o.classList.remove("open")})}),window.showToast=function(t,i,o="info",a=5e3){const d=document.getElementById("toast-container");if(!d)return;const l=document.createElement("div");l.className=`toast ${o}`;const c=o==="success"?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';l.innerHTML=`
            <div class="toast-icon">${c}</div>
            <div class="toast-content">
                <div class="toast-title">${t}</div>
                <div class="toast-message">${i}</div>
            </div>
        `,d.appendChild(l),setTimeout(()=>{l.classList.add("hiding"),setTimeout(()=>l.remove(),300)},a)};const D=new Map;function Ae(t,i,o=!1){if(!D.has(t)||o)D.set(t,{stack:[i],index:0});else{const a=D.get(t);a.index<a.stack.length-1&&(a.stack=a.stack.slice(0,a.index+1)),i!==a.stack[a.index]&&(a.stack.push(i),a.index++)}be(t)}function be(t){const i=D.get(t);if(!i)return;const o=t.querySelector(".scene-undo-btn"),a=t.querySelector(".scene-redo-btn");o&&o.classList.toggle("hidden",i.index<=0),a&&a.classList.toggle("hidden",i.index>=i.stack.length-1)}e.addEventListener("input",t=>{if(t.target.classList.contains("scene-description")){const i=t.target.closest(".scene-item"),o=D.get(i);o?(o.stack[o.index]=t.target.value,o.index<o.stack.length-1&&(o.stack=o.stack.slice(0,o.index+1)),be(i)):Ae(i,t.target.value,!0)}}),e&&e.addEventListener("click",async t=>{const i=t.target.closest(".scene-undo-btn");if(i){const f=i.closest(".scene-item"),v=D.get(f);if(v&&v.index>0){v.index--;const w=f.querySelector(".scene-description");w.value=v.stack[v.index],be(f),showToast("Undo","Reverted to previous version","info"),g.trackEvent("undo_enhance")}return}const o=t.target.closest(".scene-redo-btn");if(o){const f=o.closest(".scene-item"),v=D.get(f);if(v&&v.index<v.stack.length-1){v.index++;const w=f.querySelector(".scene-description");w.value=v.stack[v.index],be(f),showToast("Redo","Restored next version","info"),g.trackEvent("redo_enhance")}return}const a=t.target.closest(".scene-enhance-btn");if(!a)return;const d=a.closest(".scene-item");if(!d)return;const l=d.querySelector(".scene-description"),c=x.getConfiguredProviders();if(c.length===0){showToast("Configuration Required","Please configure an AI provider in the integration hub first.","warning");return}const u=c[0];a.classList.add("loading"),a.disabled=!0;try{const f=l.value.trim(),v=d.querySelector(".scene-camera-value").value,w=d.querySelector(".scene-lighting-value").value,S=d.querySelector(".scene-negative-prompt").value.trim();if(!f){showToast("Description Required","Please describe the scene before enhancing.","warning");return}D.has(d)||Ae(d,f,!0);const M={description:f,camera:v||"",lighting:w||"",negative_prompt:S||""},X=L.getParams().platform_preset,ee=L.modelService.getProfile(X),H=await x.generatePrompt(u,M,{modelProfile:ee});l.value=H,g.trackEnhance(f.length,H.length),Ae(d,H),showToast("Scene Enhanced","AI version added to history stack!","success")}catch(f){console.error("Enhance Error:",f);let v="AI Enhancement Failed",w=f.message;(f.message.toLowerCase().includes("quota")||f.message.toLowerCase().includes("rate limit"))&&(v="Quota Exceeded",w="Wait a moment or switch to Gemini 1.5 Flash."),showToast(v,w,"error")}finally{a.classList.remove("loading"),a.disabled=!1}});const N=document.getElementById("history-modal"),et=document.getElementById("history-list"),re=document.getElementById("history-preview-code"),de=document.getElementById("history-preview-actions"),tt=document.getElementById("history-section-list"),le=document.getElementById("history-section-preview-code"),ce=document.getElementById("history-section-preview-actions");let J=null;(at=document.getElementById("history-trigger-btn"))==null||at.addEventListener("click",()=>{j("modal"),N==null||N.classList.remove("hidden")}),(rt=document.getElementById("history-close-btn"))==null||rt.addEventListener("click",()=>{N==null||N.classList.add("hidden")});const it=()=>{confirm("Are you sure you want to clear all history?")&&(A.clear(),g.trackEvent("history_clear_all"),j("modal"),j("section"),re&&(re.textContent="History cleared."),le&&(le.textContent="History cleared."),de&&de.classList.add("hidden"),ce&&ce.classList.add("hidden"),showToast("History Cleared","All recorded versions have been removed.","info"))};(dt=document.getElementById("history-clear-btn"))==null||dt.addEventListener("click",it),(lt=document.getElementById("history-section-clear-btn"))==null||lt.addEventListener("click",it);const nt=()=>{if(J){r.value=JSON.stringify(J.content,null,2),N==null||N.classList.add("hidden"),g.trackEvent("history_restore_item",{item_id:J.id});const t=document.querySelector(".main-nav a.active");if((t==null?void 0:t.textContent.trim())==="History"){const i=Array.from(document.querySelectorAll(".main-nav a")).find(o=>o.textContent.trim()==="JSON Generator");i==null||i.click()}document.getElementById("output-section").classList.remove("hidden"),document.getElementById("output-section").scrollIntoView({behavior:"smooth",block:"start"}),showToast("Restored","Version loaded into output editor.","success")}};(ct=document.getElementById("history-restore-btn"))==null||ct.addEventListener("click",nt),(mt=document.getElementById("history-section-restore-btn"))==null||mt.addEventListener("click",nt);function j(t){const i=A.getAll(),o=t==="modal"?et:tt;if(o){if(o.innerHTML="",i.length===0){o.innerHTML='<div class="empty-state" style="padding: 20px; font-size: 0.85rem;">No history found.</div>';return}i.forEach(a=>{const d=document.createElement("div");d.className="history-item",d.dataset.id=a.id;const l=new Date(a.timestamp),c=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=l.toLocaleDateString(),f=a.mode==="ai"?"badge-ai":"badge-json",v=a.mode==="ai"?"AI":"JSON";d.innerHTML=`
                <div class="history-item-top">
                    <div class="history-summary">${a.summary||"Generated Prompt"}</div>
                    <span class="history-badge ${f}">${v}</span>
                </div>
                <div class="history-item-bottom">
                    <div class="history-date">${u} ${c}</div>
                    <button class="history-delete-btn" title="Delete Version">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            `,d.querySelector(".history-delete-btn").addEventListener("click",S=>{S.stopPropagation(),confirm("Delete this version history?")&&(A.delete(a.id),j("modal"),j("section"),J&&J.id===a.id&&(J=null,de&&de.classList.add("hidden"),ce&&ce.classList.add("hidden"),re&&(re.innerHTML='<div class="placeholder-content">Select an item from the sidebar...</div>'),le&&(le.innerHTML='<div class="placeholder-content">Select an item from the sidebar...</div>')))}),d.addEventListener("click",()=>_t(a,d,t)),o.appendChild(d)})}}function _t(t,i,o){const a=o==="modal"?et:tt;a==null||a.querySelectorAll(".history-item").forEach(c=>c.classList.remove("active")),i.classList.add("active"),J=t;const d=o==="modal"?re:le,l=o==="modal"?de:ce;l&&l.classList.remove("hidden"),d&&(d.textContent=JSON.stringify(t.content,null,2)),o==="modal"&&window.historysSidebarController&&window.historysSidebarController.close()}window.renderHistoryView=j;const st=document.getElementById("save-as-template"),ot=document.getElementById("open-template-gallery");st&&st.addEventListener("click",()=>{const t=[];e.querySelectorAll(".scene-item").forEach(a=>{var S,M,X,ee,H,Se;const d=a.querySelector(".scene-description").value,l=((S=a.querySelector(".scene-camera-input"))==null?void 0:S.value)||"",c=((M=a.querySelector(".scene-lighting-input"))==null?void 0:M.value)||"",u=((X=a.querySelector(".scene-color-input"))==null?void 0:X.value)||"",f=((ee=a.querySelector(".scene-mood-input"))==null?void 0:ee.value)||"",v=((H=a.querySelector(".scene-sound-input"))==null?void 0:H.value)||"",w=((Se=a.querySelector(".scene-negative-prompt"))==null?void 0:Se.value)||"";t.push({description:d,camera:l,lighting:c,color:u,mood:f,sound:v,customNegative:w})});const o={scenes:t,globalParams:L.getParams()};window.templateUI?window.templateUI.openSaveModal(o):console.error("TemplateUI not found")}),ot&&ot.addEventListener("click",()=>{window.templateUI&&window.templateUI.openGallery()}),window.addEventListener("apply-template",t=>{const i=t.detail;!i||!i.scenes||confirm("Apply this template? Current scenes will be replaced.")&&(e.querySelectorAll(".scene-item").forEach(a=>a.remove()),te=0,i.scenes.forEach(a=>{n.click();const d=e.lastElementChild;d&&(d.querySelector(".scene-description").value=a.description||"",d.querySelector(".scene-camera-input").value=a.camera||"",d.querySelector(".scene-lighting-input").value=a.lighting||"",d.querySelector(".scene-color-input").value=a.color||"",d.querySelector(".scene-mood-input").value=a.mood||"",d.querySelector(".scene-sound-input").value=a.sound||"",d.querySelector(".scene-negative-prompt").value=a.customNegative||"")}),i.globalParams&&(["aspect_ratio","resolution","frame_rate","platform_preset"].forEach(a=>{i.globalParams[a]&&L.updateParam(a,i.globalParams[a])}),pe()),showToast("Template Applied","Configuration loaded successfully.","success"))})});
